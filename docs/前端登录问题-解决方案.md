# 前端登录问题 - 解决方案

## 问题描述

前端页面刷新后出现 500 错误，提示"未登录或认证信息无效"。

## 原因分析

1. **Token 过期**：JWT token 有过期时间，过期后需要重新登录
2. **Token 未保存**：刷新页面后 token 丢失
3. **Cookie 未设置**：后端返回的 session cookie 可能没有正确设置

## 解决方案

### 方案 1: 重新登录（推荐）

1. 打开浏览器访问：http://localhost:5173
2. 如果看到登录页面，输入：
   - 用户名：`admin`
   - 密码：`admin123!`
3. 点击登录

### 方案 2: 清除浏览器缓存

如果登录后仍然出现问题：

1. 打开浏览器开发者工具（F12）
2. 进入 Application 标签
3. 清除以下内容：
   - Local Storage
   - Session Storage
   - Cookies
4. 刷新页面
5. 重新登录

### 方案 3: 检查 Token 存储

打开浏览器开发者工具（F12），在 Console 中运行：

```javascript
// 检查 localStorage 中的 token
console.log('Token:', localStorage.getItem('token'))
console.log('Session ID:', localStorage.getItem('session_id'))

// 检查 cookies
console.log('Cookies:', document.cookie)
```

如果没有 token，说明登录后没有正确保存，需要重新登录。

## 验证后端是否正常

可以使用以下命令测试后端 API：

```powershell
# 1. 登录获取 token
$response = curl http://localhost:8000/api/v1/auth/login -Method POST -ContentType "application/json" -Body '{"username":"admin","password":"admin123!"}'
$response.Content

# 2. 使用 token 访问 API（替换 YOUR_TOKEN 为实际的 token）
curl http://localhost:8000/api/v1/operation/sessions -Headers @{"Authorization"="Bearer YOUR_TOKEN"}
```

如果返回 200 状态码，说明后端正常，问题在前端。

## 常见问题

### Q1: 为什么刷新页面后需要重新登录？

A: 这取决于前端如何存储 token：
- 如果存储在 `sessionStorage`，刷新页面后会丢失
- 如果存储在 `localStorage`，刷新页面后应该保留
- 如果使用 Cookie，需要确保 Cookie 设置正确

### Q2: Token 的有效期是多久？

A: 默认是 24 小时（在 `backend/.env.local` 中的 `JWT_EXPIRE_HOURS` 配置）

### Q3: 如何延长 Token 有效期？

A: 修改 `backend/.env.local`：

```env
JWT_EXPIRE_HOURS=168  # 7天
```

然后重启后端服务。

## 开发建议

在开发环境中，建议：

1. **使用 localStorage 存储 token**：刷新页面后不会丢失
2. **实现 token 刷新机制**：token 快过期时自动刷新
3. **添加登录状态检查**：页面加载时检查 token 是否有效

## 下一步

如果问题仍然存在，请检查：

1. 后端日志：查看是否有错误信息
2. 前端 Network 标签：查看请求和响应的详细信息
3. 前端 Console：查看是否有 JavaScript 错误

---

**提示**：本地开发环境已经配置完成，后端和前端都在正常运行。只需要重新登录即可使用系统。
