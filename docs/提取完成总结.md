# è¿è¥æ•°æ®åˆ†æåŠŸèƒ½æå–å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®ç»“æ„åˆ›å»º
- âœ… åˆ›å»ºäº†ç‹¬ç«‹é¡¹ç›®ç›®å½• `operation-data-analysis`
- âœ… å»ºç«‹äº†å®Œæ•´çš„å‰åç«¯ç›®å½•ç»“æ„

### 2. åç«¯ä»£ç æå–

#### æ ¸å¿ƒé…ç½®
- âœ… `app/core/config.py` - ç³»ç»Ÿé…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… `app/core/database.py` - æ•°æ®åº“è¿æ¥
- âœ… `app/core/redis.py` - Redisè¿æ¥
- âœ… `app/core/security.py` - å®‰å…¨å·¥å…·ï¼ˆJWTã€å¯†ç åŠ å¯†ï¼‰

#### æ•°æ®æ¨¡å‹
- âœ… `app/models/user.py` - ç”¨æˆ·æ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼Œç§»é™¤é¡¹ç›®å…³ç³»ï¼‰
- âœ… `app/models/session.py` - ä¼šè¯æ¨¡å‹ï¼ˆä»workflow.pyæå–ï¼‰
- âœ… `app/models/workflow.py` - å·¥ä½œæµæ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼Œç§»é™¤é¡¹ç›®å…³ç³»ï¼‰
- âœ… `app/models/batch_analysis.py` - æ‰¹é‡åˆ†ææ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆï¼Œç§»é™¤é¡¹ç›®å…³ç³»ï¼‰

#### APIè·¯ç”±
- âœ… `app/api/v1/operation.py` - å•æ–‡ä»¶åˆ†æAPIï¼ˆç§»é™¤project_idä¾èµ–ï¼‰
- âœ… `app/api/v1/operation_batch.py` - æ‰¹é‡åˆ†æAPIï¼ˆç§»é™¤project_idä¾èµ–ï¼‰
- âœ… `app/api/v1/auth.py` - è®¤è¯APIï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… `app/api/v1/workflow.py` - å·¥ä½œæµç®¡ç†APIï¼ˆç§»é™¤project_idä¾èµ–ï¼‰
- âœ… `app/api/deps.py` - APIä¾èµ–é¡¹ï¼ˆç®€åŒ–ç‰ˆï¼‰

#### æœåŠ¡å±‚
- âœ… `app/services/excel_service.py` - Excelå¤„ç†æœåŠ¡
- âœ… `app/services/dify_service.py` - Difyé›†æˆæœåŠ¡ï¼ˆç§»é™¤project_idå‚æ•°ï¼‰
- âœ… `app/services/workflow_service.py` - å·¥ä½œæµæœåŠ¡ï¼ˆç§»é™¤project_idå‚æ•°ï¼‰
- âœ… `app/services/auth_service.py` - è®¤è¯æœåŠ¡ï¼ˆç®€åŒ–ç‰ˆï¼‰

#### å·¥å…·ç±»
- âœ… `app/utils/pdf_generator.py` - PDFç”Ÿæˆå·¥å…·
- âœ… `app/utils/echarts_parser.py` - EChartsè§£æå·¥å…·
- âœ… `app/utils/image_generator.py` - å›¾ç‰‡ç”Ÿæˆå·¥å…·

#### Schemaå®šä¹‰
- âœ… `app/schemas/common.py` - é€šç”¨å“åº”æ¨¡å‹
- âœ… `app/schemas/auth.py` - è®¤è¯Schemaï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… `app/schemas/workflow.py` - å·¥ä½œæµSchemaï¼ˆç®€åŒ–ç‰ˆï¼‰

### 3. å‰ç«¯ä»£ç æå–

#### APIæ¥å£
- âœ… `src/api/operation.ts` - è¿è¥æ•°æ®åˆ†æAPIï¼ˆç§»é™¤project_idå‚æ•°ï¼‰
- âœ… `src/api/workflow.ts` - å·¥ä½œæµAPIï¼ˆç§»é™¤project_idå‚æ•°ï¼‰

#### é¡µé¢ç»„ä»¶
- âœ… `src/views/Operation/DataAnalysis.vue` - å•æ–‡ä»¶åˆ†æé¡µé¢ï¼ˆç§»é™¤project_idä¾èµ–ï¼‰
- âœ… `src/views/Operation/BatchAnalysis.vue` - æ‰¹é‡åˆ†æé¡µé¢ï¼ˆç§»é™¤project_idä¾èµ–ï¼‰

#### å­ç»„ä»¶
- âœ… `src/views/Operation/components/HistorySidebar.vue` - å†å²ä¼šè¯ä¾§è¾¹æ ï¼ˆç§»é™¤project_idï¼‰
- âœ… `src/views/Operation/components/BatchHistorySidebar.vue` - æ‰¹é‡åˆ†æå†å²ä¾§è¾¹æ ï¼ˆç§»é™¤project_idï¼‰
- âœ… `src/views/Operation/components/ReportTabs.vue` - æŠ¥å‘Šæ ‡ç­¾é¡µ
- âœ… `src/views/Operation/components/ReportDisplay.vue` - æŠ¥å‘Šæ˜¾ç¤ºç»„ä»¶ï¼ˆç§»é™¤project_idï¼‰

### 4. Dockeré…ç½®å’Œéƒ¨ç½²

#### Dockeré…ç½®
- âœ… `docker-compose.yml` - ç”Ÿäº§ç¯å¢ƒDocker Composeé…ç½®
- âœ… `docker-compose.dev.yml` - å¼€å‘ç¯å¢ƒDocker Composeé…ç½®
- âœ… `backend/Dockerfile` - åç«¯Dockerfile
- âœ… `frontend/Dockerfile` - å‰ç«¯ç”Ÿäº§ç¯å¢ƒDockerfile
- âœ… `frontend/Dockerfile.dev` - å‰ç«¯å¼€å‘ç¯å¢ƒDockerfile
- âœ… `.dockerignore` - Dockerå¿½ç•¥æ–‡ä»¶

#### Nginxé…ç½®
- âœ… `nginx/nginx.conf` - Nginxä¸»é…ç½®
- âœ… `nginx/conf.d/default.conf` - ç«™ç‚¹é…ç½®
- âœ… `nginx/Dockerfile` - Nginx Dockerfile
- âœ… `frontend/nginx.conf` - å‰ç«¯Nginxé…ç½®

#### æ•°æ®åº“è¿ç§»
- âœ… `backend/alembic.ini` - Alembicé…ç½®
- âœ… `backend/migrations/env.py` - è¿ç§»ç¯å¢ƒé…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… `backend/migrations/script.py.mako` - è¿ç§»è„šæœ¬æ¨¡æ¿

#### åˆå§‹åŒ–è„šæœ¬
- âœ… `backend/scripts/create_admin.py` - åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·è„šæœ¬

#### é…ç½®æ–‡ä»¶
- âœ… `backend/requirements.txt` - Pythonä¾èµ–
- âœ… `frontend/package.json` - å‰ç«¯ä¾èµ–
- âœ… `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- âœ… `.gitignore` - Gitå¿½ç•¥æ–‡ä»¶

#### æ–‡æ¡£
- âœ… `README.md` - é¡¹ç›®è¯´æ˜æ–‡æ¡£
- âœ… `éƒ¨ç½²æŒ‡å—.md` - è¯¦ç»†éƒ¨ç½²æŒ‡å—

### 5. ä»£ç ç®€åŒ–

#### ç§»é™¤é¡¹ç›®ä¾èµ–
- âœ… æ‰€æœ‰APIè·¯ç”±ç§»é™¤ `project_id` å‚æ•°
- âœ… æ‰€æœ‰æœåŠ¡æ–¹æ³•ç§»é™¤ `project_id` å‚æ•°
- âœ… ä½¿ç”¨å›ºå®šå€¼ `DEFAULT_PROJECT_ID = 1` æ›¿ä»£é¡¹ç›®ID
- âœ… å‰ç«¯ç»„ä»¶ç§»é™¤æ‰€æœ‰ `project_id` ç›¸å…³ä»£ç 
- âœ… å‰ç«¯APIæ¥å£ç§»é™¤æ‰€æœ‰ `project_id` å‚æ•°

#### ç®€åŒ–æƒé™ç³»ç»Ÿ
- âœ… ç§»é™¤é¡¹ç›®æƒé™æ£€æŸ¥
- âœ… ç®€åŒ–ç”¨æˆ·æƒé™éªŒè¯
- âœ… ä¿ç•™åŸºæœ¬çš„ç”¨æˆ·è®¤è¯å’Œè¶…çº§ç®¡ç†å‘˜åŠŸèƒ½

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
operation-data-analysis/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚       â”œâ”€â”€ operation.py
â”‚   â”‚   â”‚       â”œâ”€â”€ operation_batch.py
â”‚   â”‚   â”‚       â””â”€â”€ workflow.py
â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯ä¾èµ–
â”‚   â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/            # Pydanticæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·ç±»
â”‚   â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ scripts/                # åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ main.py                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile              # åç«¯Dockerfile
â”‚   â””â”€â”€ alembic.ini             # Alembicé…ç½®
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                # APIæ¥å£
â”‚   â”‚   â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Operation/
â”‚   â”‚   â”‚       â”œâ”€â”€ DataAnalysis.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ BatchAnalysis.vue
â”‚   â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile              # å‰ç«¯Dockerfile
â”‚   â””â”€â”€ nginx.conf              # å‰ç«¯Nginxé…ç½®
â”œâ”€â”€ nginx/                      # Nginxé…ç½®
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”œâ”€â”€ conf.d/
â”‚   â”‚   â””â”€â”€ default.conf
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml          # Docker Composeé…ç½®
â”œâ”€â”€ docker-compose.dev.yml      # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .dockerignore               # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â””â”€â”€ éƒ¨ç½²æŒ‡å—.md                 # éƒ¨ç½²æŒ‡å—
```

## ğŸ”‘ å…³é”®ä¿®æ”¹ç‚¹

### 1. é¡¹ç›®IDå¤„ç†
- **åŸç³»ç»Ÿ**ï¼šå¤šé¡¹ç›®ç³»ç»Ÿï¼Œæ‰€æœ‰APIéƒ½éœ€è¦ `project_id` å‚æ•°
- **æ–°ç³»ç»Ÿ**ï¼šå•é¡¹ç›®ç³»ç»Ÿï¼Œä½¿ç”¨å›ºå®šå€¼ `DEFAULT_PROJECT_ID = 1`
- **ä¿®æ”¹æ–¹å¼**ï¼š
  - åç«¯ï¼šç§»é™¤æ‰€æœ‰ `project_id` å‚æ•°ï¼Œä½¿ç”¨å›ºå®šå€¼
  - å‰ç«¯ï¼šç§»é™¤æ‰€æœ‰ `project_id` ç›¸å…³ä»£ç å’Œå‚æ•°ä¼ é€’

### 2. æƒé™ç³»ç»Ÿç®€åŒ–
- **åŸç³»ç»Ÿ**ï¼šé¡¹ç›®çº§æƒé™ç®¡ç†
- **æ–°ç³»ç»Ÿ**ï¼šç®€åŒ–ä¸ºç”¨æˆ·çº§æƒé™ï¼ˆè¶…çº§ç®¡ç†å‘˜/æ™®é€šç”¨æˆ·ï¼‰
- **ä¿®æ”¹æ–¹å¼**ï¼šç§»é™¤é¡¹ç›®æƒé™æ£€æŸ¥ï¼Œä¿ç•™åŸºæœ¬ç”¨æˆ·è®¤è¯

### 3. æ•°æ®æ¨¡å‹ç®€åŒ–
- **ç§»é™¤å…³ç³»**ï¼šç§»é™¤æ‰€æœ‰ä¸ `Project` æ¨¡å‹çš„å…³ç³»
- **ä¿ç•™å­—æ®µ**ï¼šä¿ç•™ `project_id` å­—æ®µä½œä¸ºæ™®é€šæ•´æ•°ï¼ˆå›ºå®šä¸º1ï¼‰
- **æ¨¡å‹é‡ç»„**ï¼šå°† `Conversation` ä» `workflow.py` ç§»åˆ° `session.py`

## ğŸš€ ä¸‹ä¸€æ­¥å·¥ä½œ

### éœ€è¦æ‰‹åŠ¨å®Œæˆçš„å·¥ä½œ

1. **æ•°æ®åº“è¿ç§»è„šæœ¬**
   - éœ€è¦è¿è¡Œ `alembic revision --autogenerate -m "initial"` ç”Ÿæˆåˆå§‹è¿ç§»
   - æ£€æŸ¥è¿ç§»è„šæœ¬æ˜¯å¦æ­£ç¡®

2. **å‰ç«¯è·¯ç”±é…ç½®**
   - éœ€è¦åˆ›å»ºå‰ç«¯è·¯ç”±é…ç½®æ–‡ä»¶
   - é…ç½® `/operation` å’Œ `/operation/batch` è·¯ç”±

3. **å‰ç«¯Storeé…ç½®**
   - éœ€è¦åˆ›å»ºæˆ–å¤åˆ¶ `stores/operation.ts` çŠ¶æ€ç®¡ç†
   - ç¡®ä¿ä¸APIæ¥å£åŒ¹é…

4. **ç¯å¢ƒå˜é‡é…ç½®**
   - å¤åˆ¶ `.env.example` ä¸º `.env`
   - ä¿®æ”¹æ‰€æœ‰æ•æ„Ÿé…ç½®é¡¹

5. **æµ‹è¯•å’ŒéªŒè¯**
   - å¯åŠ¨DockeræœåŠ¡
   - æµ‹è¯•APIæ¥å£
   - æµ‹è¯•å‰ç«¯åŠŸèƒ½

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Difyé…ç½®**ï¼šç³»ç»Ÿä¾èµ–Difyå·¥ä½œæµï¼Œéœ€è¦å…ˆé…ç½®Dify APIå¯†é’¥å’Œå·¥ä½œæµID
2. **æ•°æ®åº“åˆå§‹åŒ–**ï¼šé¦–æ¬¡å¯åŠ¨éœ€è¦è¿è¡Œæ•°æ®åº“è¿ç§»å’Œåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
3. **æ–‡ä»¶ä¸Šä¼ ç›®å½•**ï¼šç¡®ä¿ä¸Šä¼ ç›®å½•æœ‰å†™å…¥æƒé™
4. **CORSé…ç½®**ï¼šæ ¹æ®å®é™…éƒ¨ç½²åŸŸåä¿®æ”¹CORSé…ç½®

## ğŸ¯ åŠŸèƒ½å®Œæ•´æ€§

### å·²å®ç°åŠŸèƒ½
- âœ… å•æ–‡ä»¶Excel/CSVä¸Šä¼ å’Œåˆ†æ
- âœ… æ‰¹é‡å¤šSheet Excelæ–‡ä»¶åˆ†æ
- âœ… Difyå·¥ä½œæµé›†æˆï¼ˆWorkflowå’ŒChatflowï¼‰
- âœ… æŠ¥å‘Šç”Ÿæˆï¼ˆæ–‡æœ¬+å›¾è¡¨ï¼‰
- âœ… PDFå’ŒPNGæŠ¥å‘Šä¸‹è½½
- âœ… ä¼šè¯ç®¡ç†å’Œå†å²è®°å½•
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ

### å¾…å®Œå–„åŠŸèƒ½
- âš ï¸ å‰ç«¯è·¯ç”±é…ç½®ï¼ˆéœ€è¦åˆ›å»ºï¼‰
- âš ï¸ å‰ç«¯Storeé…ç½®ï¼ˆéœ€è¦åˆ›å»ºæˆ–å¤åˆ¶ï¼‰
- âš ï¸ æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆéœ€è¦ç”Ÿæˆï¼‰
- âš ï¸ å·¥ä½œæµé…ç½®UIï¼ˆéƒ¨åˆ†åŠŸèƒ½å¾…å®ç°ï¼‰

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. `README.md` - é¡¹ç›®è¯´æ˜
2. `éƒ¨ç½²æŒ‡å—.md` - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
3. APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs

---

**æå–å®Œæˆæ—¶é—´**ï¼š2024å¹´
**æå–çŠ¶æ€**ï¼šâœ… æ ¸å¿ƒåŠŸèƒ½å·²æå–å®Œæˆï¼Œå¯è¿›è¡Œæµ‹è¯•å’Œéƒ¨ç½²

