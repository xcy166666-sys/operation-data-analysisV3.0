# 版本历史查看功能 - 测试指南

## 📋 功能概述

版本历史查看功能允许用户：
1. 在左侧会话列表中展开/折叠版本面板
2. 查看会话的所有历史版本
3. 点击版本查看该版本的完整报告内容
4. 通过版本提示条返回当前版本

---

## 🎯 测试前准备

### 1. 确保服务运行
```bash
# 检查后端服务
docker ps | findstr operation-analysis-v2-backend

# 检查前端服务
# 应该在 http://localhost:5173 运行
```

### 2. 准备测试数据
- 至少有一个会话
- 该会话至少保存了2个版本（V1, V2）

---

## 🧪 测试步骤

### 测试1：展开/折叠版本面板

#### 步骤：
1. 打开 http://localhost:5173
2. 在左侧会话列表中找到一个会话
3. 点击会话项右侧的"📄"图标

#### 预期结果：
- ✅ 版本面板平滑展开
- ✅ 显示"📌 版本历史 (X个版本)"标题
- ✅ 图标变为向下箭头
- ✅ 再次点击图标，面板平滑收起

#### 截图位置：
```
┌─────────────────────────────────────┐
│ 📄 LTV - 副本 (2)                    │
│    今天                    [📄]      │  ← 点击此图标
│    进行中                            │
└─────────────────────────────────────┘
```

---

### 测试2：加载版本列表

#### 步骤：
1. 首次展开版本面板

#### 预期结果：
- ✅ 显示加载动画（旋转图标 + "正在加载版本..."）
- ✅ 加载完成后显示版本列表
- ✅ 版本按时间倒序排列（最新的在上面）
- ✅ 当前版本显示"[当前]"标签（绿色）

#### 版本列表示例：
```
┌─────────────────────────────────────┐
│ 📌 版本历史 (2个版本)               │
├─────────────────────────────────────┤
│ V2 - 添加了新的分析章节              │
│ 2分钟前                    [当前]   │  ← 绿色标签
├─────────────────────────────────────┤
│ V1 - 初始版本                       │
│ 10分钟前                            │
└─────────────────────────────────────┘
```

---

### 测试3：查看历史版本

#### 步骤：
1. 展开版本面板
2. 点击一个历史版本（例如 V1）

#### 预期结果：
- ✅ 显示提示消息："正在加载版本 V1..."
- ✅ 右侧报告内容切换为该版本的内容
- ✅ 顶部显示版本提示条：
  ```
  ℹ️ 正在查看历史版本 V1 - 初始版本 (10分钟前)  [返回当前版本]
  ```
- ✅ 版本提示条为蓝色信息样式
- ✅ 显示成功消息："已切换到版本 V1"

#### 版本提示条样式：
```
┌──────────────────────────────────────────────────────────┐
│ ℹ️ 正在查看历史版本 V1 - 初始版本 (10分钟前)  [返回当前版本] │
└──────────────────────────────────────────────────────────┘
```

---

### 测试4：返回当前版本

#### 步骤：
1. 在查看历史版本时
2. 点击版本提示条中的"返回当前版本"按钮

#### 预期结果：
- ✅ 右侧报告内容切换回当前版本
- ✅ 版本提示条消失
- ✅ 显示成功消息："已返回当前版本"
- ✅ 左侧版本列表中，当前版本仍显示"[当前]"标签

---

### 测试5：版本面板交互

#### 步骤：
1. 悬停在版本项上
2. 点击不同的版本

#### 预期结果：
- ✅ 悬停时背景色变为浅蓝色 `#ecf5ff`
- ✅ 悬停时显示"点击查看"提示（可选）
- ✅ 当前版本始终有蓝色边框
- ✅ 点击版本时有加载反馈

---

### 测试6：空状态

#### 步骤：
1. 创建一个新会话（没有保存任何版本）
2. 展开版本面板

#### 预期结果：
- ✅ 显示空状态提示：
  ```
  暂无保存的版本
  点击右上角"保存版本"按钮创建版本
  ```
- ✅ 显示空状态图标

---

### 测试7：版本时间格式化

#### 步骤：
1. 查看不同时间的版本

#### 预期结果：
- ✅ 1分钟内：显示"刚刚"
- ✅ 1-60分钟：显示"X分钟前"
- ✅ 1-24小时：显示"X小时前"
- ✅ 1-7天：显示"X天前"
- ✅ 7天以上：显示完整日期（例如："2024年12月24日 12:30"）

---

### 测试8：版本面板刷新

#### 步骤：
1. 展开版本面板
2. 在另一个标签页保存新版本
3. 点击版本面板头部的"刷新"按钮

#### 预期结果：
- ✅ 显示加载动画
- ✅ 版本列表更新，显示新版本
- ✅ 版本号正确递增

---

### 测试9：多会话切换

#### 步骤：
1. 展开会话A的版本面板
2. 点击会话B
3. 再次点击会话A

#### 预期结果：
- ✅ 切换到会话B时，会话A的版本面板自动收起
- ✅ 再次点击会话A时，版本面板保持收起状态
- ✅ 需要重新点击图标才能展开

---

### 测试10：错误处理

#### 步骤：
1. 断开网络连接
2. 尝试加载版本列表

#### 预期结果：
- ✅ 显示错误提示："加载版本列表失败"
- ✅ 提供重试按钮（可选）
- ✅ 不会导致页面崩溃

---

## 🎨 视觉检查清单

### 版本面板样式
- [ ] 面板背景色：`#2f2f32`（深灰色）
- [ ] 面板边框：`1px solid #3a3a3c`
- [ ] 面板圆角：`0 0 8px 8px`（底部圆角）
- [ ] 面板内边距：`8px 12px 4px 36px`

### 版本项样式
- [ ] 默认背景：透明
- [ ] 悬停背景：浅色高亮
- [ ] 当前版本：绿色标签 `#4ade80`
- [ ] 版本号：粗体显示
- [ ] 版本说明：正常字体，灰色
- [ ] 时间：小字体，浅灰色

### 版本提示条样式
- [ ] 背景色：蓝色信息样式
- [ ] 显示位置：工作流状态提示上方
- [ ] 按钮样式：主要按钮（蓝色）
- [ ] 文字对齐：左对齐，按钮右对齐

### 动画效果
- [ ] 展开/折叠：平滑过渡（300ms）
- [ ] 悬停：背景色渐变（150ms）
- [ ] 加载：旋转动画

---

## 🐛 已知问题

### 问题1：版本面板位置
- **描述**：版本面板可能与会话项重叠
- **解决方案**：调整 `margin` 和 `padding`

### 问题2：版本列表滚动
- **描述**：版本数量过多时，面板高度不够
- **解决方案**：添加 `max-height` 和 `overflow-y: auto`

### 问题3：版本切换延迟
- **描述**：切换版本时可能有短暂延迟
- **解决方案**：添加加载动画，提升用户体验

---

## 📊 性能测试

### 测试场景1：大量版本
- **步骤**：创建一个有50个版本的会话
- **预期**：版本列表加载时间 < 1秒
- **优化**：使用虚拟滚动（如果版本数 > 20）

### 测试场景2：频繁切换
- **步骤**：快速点击不同版本
- **预期**：不会出现卡顿或错误
- **优化**：添加防抖/节流

### 测试场景3：大报告内容
- **步骤**：查看包含大量图表的版本
- **预期**：切换时间 < 2秒
- **优化**：懒加载图表

---

## ✅ 测试通过标准

### 功能完整性
- [x] 版本面板展开/折叠正常
- [x] 版本列表加载正常
- [x] 版本切换功能正常
- [x] 返回当前版本功能正常
- [x] 版本提示条显示正常

### 用户体验
- [x] 动画流畅自然
- [x] 加载状态清晰
- [x] 错误提示友好
- [x] 交互反馈及时

### 视觉设计
- [x] 样式符合设计规范
- [x] 颜色搭配协调
- [x] 字体大小合适
- [x] 间距布局合理

### 性能表现
- [x] 加载速度快
- [x] 切换流畅
- [x] 内存占用合理
- [x] 无明显卡顿

---

## 🎉 测试完成

如果所有测试都通过，恭喜！版本历史查看功能已经完整实现并可以投入使用。

如果有任何问题，请参考：
- `docs/版本历史查看功能-交互设计方案.md` - 设计文档
- `docs/报告版本历史功能-问题诊断与修复.md` - 问题排查指南
- `frontend/src/views/Operation/components/HistorySidebar.vue` - 前端组件代码
- `backend/app/api/v1/operation.py` - 后端API代码

---

## 📝 反馈与改进

如果在测试过程中发现任何问题或有改进建议，请记录在此：

### 问题记录
1. 

### 改进建议
1. 

### 用户反馈
1. 
