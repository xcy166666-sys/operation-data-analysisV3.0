# å¦‚ä½•æŸ¥çœ‹æ—¥å¿—éªŒè¯HTMLå›¾è¡¨ä¿®å¤

## ğŸŒ æ–¹æ³•1ï¼šæµè§ˆå™¨æ§åˆ¶å°ï¼ˆæ¨èï¼Œæœ€ç›´è§‚ï¼‰

### æ‰“å¼€æ–¹å¼
1. è®¿é—®å‰ç«¯é¡µé¢ï¼šhttp://localhost:20810
2. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** æ ‡ç­¾

### å…³é”®æ—¥å¿—

#### ç”ŸæˆæŠ¥å‘Šæ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
[å‰ç«¯æ—¥å¿—][æŠ¥å‘Šç”Ÿæˆ] æ¥æ”¶åˆ°çš„APIå“åº” {reportId: "xxx", htmlChartsExists: true, htmlChartsLength: 12345}
[DataAnalysis] HTMLå›¾è¡¨å·²ä¿å­˜åˆ°localStorageå’ŒsessionStorage: html_charts_123 é•¿åº¦: 12345
[å‰ç«¯æ—¥å¿—][æŠ¥å‘Šç”Ÿæˆ] å·²è®¾ç½® reportContent åˆ° store {storeHtmlChartsExists: true}
```

#### åˆ·æ–°é¡µé¢ååº”è¯¥çœ‹åˆ°ï¼š
```
[DataAnalysis] é¡µé¢åˆ·æ–°ï¼Œè‡ªåŠ¨åŠ è½½å½“å‰ä¼šè¯: 123
[DataAnalysis] å¼€å§‹åŠ è½½ä¼šè¯è¯¦æƒ…: 123
[DataAnalysis] ä¼šè¯è¯¦æƒ…åŠ è½½æˆåŠŸ: {sessionId: 123, messagesCount: 2}
[DataAnalysis] æœ€åä¸€æ¡assistantæ¶ˆæ¯: {hasHtmlCharts: true, htmlChartsLength: 12345}
[DataAnalysis] ä»åç«¯æ•°æ®åº“æ¢å¤HTMLå›¾è¡¨ï¼Œé•¿åº¦: 12345  â† è¿™æ˜¯æœ€å¥½çš„æƒ…å†µ
```

æˆ–è€…ï¼ˆå¦‚æœæ•°æ®åº“æ²¡æœ‰ï¼Œä»Storageæ¢å¤ï¼‰ï¼š
```
[DataAnalysis] ä»Storageæ¢å¤HTMLå›¾è¡¨: html_charts_123 é•¿åº¦: 12345 æ¥æº: sessionStorage
```

### å¦‚ä½•è¿‡æ»¤æ—¥å¿—
åœ¨æ§åˆ¶å°é¡¶éƒ¨çš„è¿‡æ»¤æ¡†è¾“å…¥ï¼š
- `html_charts` - åªçœ‹HTMLå›¾è¡¨ç›¸å…³æ—¥å¿—
- `DataAnalysis` - åªçœ‹æ•°æ®åˆ†æé¡µé¢æ—¥å¿—
- `æŠ¥å‘Šç”Ÿæˆ` - åªçœ‹æŠ¥å‘Šç”Ÿæˆç›¸å…³æ—¥å¿—

---

## ğŸ³ æ–¹æ³•2ï¼šDockeråç«¯æ—¥å¿—

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
# æŸ¥çœ‹åç«¯å®æ—¶æ—¥å¿—ï¼ˆæŒç»­è¾“å‡ºï¼‰
docker logs -f operation-analysis-v2-backend

# åªçœ‹æœ€è¿‘100è¡Œ
docker logs operation-analysis-v2-backend --tail 100

# åªçœ‹HTMLå›¾è¡¨ç›¸å…³æ—¥å¿—
docker logs operation-analysis-v2-backend --tail 200 | grep "html_charts"

# åªçœ‹éªŒè¯ä¿å­˜çš„æ—¥å¿—
docker logs operation-analysis-v2-backend --tail 200 | grep "éªŒè¯ä¿å­˜"
```

### å…³é”®æ—¥å¿—

#### ç”ŸæˆæŠ¥å‘Šæ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
[è¿è¥æ•°æ®åˆ†æ] å›¾è¡¨ç”ŸæˆæˆåŠŸ - é•¿åº¦: 12345
[è¿è¥æ•°æ®åˆ†æ] content.html_charts æ˜¯å¦å­˜åœ¨: True
[è¿è¥æ•°æ®åˆ†æ] content.html_charts é•¿åº¦: 12345
[è¿è¥æ•°æ®åˆ†æ] å¯¹è¯æ¶ˆæ¯å·²ä¿å­˜åˆ°ä¼šè¯ - session_id=123, messages_count=2
[è¿è¥æ•°æ®åˆ†æ] éªŒè¯ä¿å­˜: html_chartså·²ä¿å­˜=True, é•¿åº¦=12345  â† å…³é”®ï¼
```

#### è·å–ä¼šè¯è¯¦æƒ…æ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
[è¿è¥æ•°æ®åˆ†æ] è·å–ä¼šè¯è¯¦æƒ…æˆåŠŸ - conversation_id=123, messages_count=2
[è¿è¥æ•°æ®åˆ†æ] æ¶ˆæ¯1 (assistant) - åŒ…å«html_charts: True, é•¿åº¦: 12345
[è¿è¥æ•°æ®åˆ†æ] html_chartsé¢„è§ˆ(å‰200å­—ç¬¦): <!DOCTYPE html>...
```

---

## ğŸ—„ï¸ æ–¹æ³•3ï¼šæ£€æŸ¥æµè§ˆå™¨å­˜å‚¨

### æ‰“å¼€æ–¹å¼
1. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° **Applicationï¼ˆåº”ç”¨ï¼‰** æ ‡ç­¾
3. å·¦ä¾§å±•å¼€ **Storageï¼ˆå­˜å‚¨ï¼‰**

### æ£€æŸ¥ sessionStorage
1. ç‚¹å‡» **Session Storage** â†’ **http://localhost:20810**
2. æŸ¥æ‰¾ `html_charts_<æ•°å­—>` é”®
3. ç‚¹å‡»æŸ¥çœ‹å€¼ï¼Œåº”è¯¥æ˜¯å®Œæ•´çš„HTMLä»£ç 

### æ£€æŸ¥ localStorage
1. ç‚¹å‡» **Local Storage** â†’ **http://localhost:20810**
2. æŸ¥æ‰¾ `html_charts_<æ•°å­—>` é”®
3. æŸ¥æ‰¾ `currentSessionId` é”®ï¼ˆåº”è¯¥æ˜¯å½“å‰ä¼šè¯IDï¼‰

### æ£€æŸ¥ Store çŠ¶æ€ï¼ˆPiniaï¼‰
åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
// æŸ¥çœ‹å®Œæ•´çš„ reportContent
window.$pinia?.state?.value?.operation?.reportContent

// åªçœ‹ html_charts
window.$pinia?.state?.value?.operation?.reportContent?.html_charts

// æŸ¥çœ‹å½“å‰ä¼šè¯ID
window.$pinia?.state?.value?.operation?.currentSessionId
```

---

## ğŸ—ƒï¸ æ–¹æ³•4ï¼šæ£€æŸ¥æ•°æ®åº“ï¼ˆæœ€åº•å±‚ï¼‰

### è¿›å…¥æ•°æ®åº“
```bash
docker exec -it operation-analysis-v2-postgres psql -U postgres -d operation_analysis_v2
```

### æŸ¥è¯¢æœ€æ–°ä¼šè¯
```sql
-- æŸ¥çœ‹æœ€æ–°çš„ä¼šè¯
SELECT id, title, created_at, updated_at 
FROM analysis_sessions 
ORDER BY updated_at DESC 
LIMIT 5;

-- æŸ¥çœ‹æŸä¸ªä¼šè¯çš„æ¶ˆæ¯ï¼ˆæ›¿æ¢123ä¸ºå®é™…ä¼šè¯IDï¼‰
SELECT id, title, messages 
FROM analysis_sessions 
WHERE id = 123;

-- æ£€æŸ¥messagesä¸­æ˜¯å¦åŒ…å«html_chartsï¼ˆç¾åŒ–è¾“å‡ºï¼‰
SELECT id, title, 
       jsonb_array_length(messages) as message_count,
       messages->-1->'html_charts' IS NOT NULL as has_html_charts,
       length(messages->-1->>'html_charts') as html_charts_length
FROM analysis_sessions 
WHERE id = 123;
```

### é€€å‡ºæ•°æ®åº“
```sql
\q
```

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æ­¥éª¤1ï¼šç”Ÿæˆæ–°æŠ¥å‘Š
1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://localhost:20810
2. æŒ‰ **F12** æ‰“å¼€æ§åˆ¶å°
3. ä¸Šä¼ Excelæ–‡ä»¶ï¼Œè¾“å…¥åˆ†æéœ€æ±‚
4. ç‚¹å‡»"æäº¤ç”ŸæˆæŠ¥å‘Š"
5. **è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - `[DataAnalysis] HTMLå›¾è¡¨å·²ä¿å­˜åˆ°localStorageå’ŒsessionStorage`
   - å›¾è¡¨æ­£å¸¸æ˜¾ç¤º

### æ­¥éª¤2ï¼šæµ‹è¯•åˆ·æ–°æ¢å¤
1. åœ¨å½“å‰é¡µé¢æŒ‰ **F5** åˆ·æ–°
2. **è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - `[DataAnalysis] é¡µé¢åˆ·æ–°ï¼Œè‡ªåŠ¨åŠ è½½å½“å‰ä¼šè¯`
   - `[DataAnalysis] ä»åç«¯æ•°æ®åº“æ¢å¤HTMLå›¾è¡¨` æˆ– `ä»Storageæ¢å¤HTMLå›¾è¡¨`
3. **ç¡®è®¤å›¾è¡¨ä»ç„¶æ˜¾ç¤º**

### æ­¥éª¤3ï¼šæ£€æŸ¥åç«¯æ—¥å¿—
```bash
# åœ¨PowerShellä¸­æ‰§è¡Œ
docker logs operation-analysis-v2-backend --tail 100 | Select-String "éªŒè¯ä¿å­˜"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
éªŒè¯ä¿å­˜: html_chartså·²ä¿å­˜=True, é•¿åº¦=12345
```

### æ­¥éª¤4ï¼šæ£€æŸ¥å­˜å‚¨
1. æŒ‰ **F12** â†’ **Application** â†’ **Session Storage**
2. æŸ¥æ‰¾ `html_charts_<æ•°å­—>` é”®
3. ç¡®è®¤æœ‰å€¼ä¸”æ˜¯HTMLä»£ç 

---

## âŒ å¦‚æœå‡ºç°é—®é¢˜

### é—®é¢˜1ï¼šåˆ·æ–°åå›¾è¡¨æ¶ˆå¤±

**æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—**ï¼š
```
[DataAnalysis] ä»Storageæ¢å¤HTMLå›¾è¡¨: html_charts_123 é•¿åº¦: 0
```
æˆ–
```
[DataAnalysis] Storageä¸­æ²¡æœ‰æ‰¾åˆ°HTMLå›¾è¡¨æ•°æ®
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰ `éªŒè¯ä¿å­˜: html_chartså·²ä¿å­˜=True`
2. å¦‚æœæ˜¯Falseï¼Œè¯´æ˜æ•°æ®åº“ä¿å­˜å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. å¦‚æœæ˜¯Trueï¼Œè¯´æ˜å‰ç«¯æ¢å¤é€»è¾‘æœ‰é—®é¢˜

### é—®é¢˜2ï¼šåç«¯æ—¥å¿—æ˜¾ç¤º html_chartså·²ä¿å­˜=False

**æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€**ï¼š
```bash
docker ps | Select-String "backend"
```

å¦‚æœæ˜¾ç¤º `unhealthy`ï¼Œé‡å¯åç«¯ï¼š
```bash
docker-compose restart backend
```

### é—®é¢˜3ï¼šæ§åˆ¶å°æ²¡æœ‰ä»»ä½•æ—¥å¿—

**æ£€æŸ¥æ§åˆ¶å°è¿‡æ»¤å™¨**ï¼š
- ç¡®ä¿æ²¡æœ‰å‹¾é€‰ "Hide network" æˆ–å…¶ä»–è¿‡æ»¤é€‰é¡¹
- ç¡®ä¿ "All levels" å·²é€‰ä¸­ï¼ˆæ˜¾ç¤ºæ‰€æœ‰çº§åˆ«çš„æ—¥å¿—ï¼‰

---

## ğŸ“Š æ­£å¸¸æƒ…å†µä¸‹çš„å®Œæ•´æ—¥å¿—æµ

### ç”ŸæˆæŠ¥å‘Š
```
å‰ç«¯æ§åˆ¶å°ï¼š
[å‰ç«¯æ—¥å¿—][æŠ¥å‘Šç”Ÿæˆ] æ¥æ”¶åˆ°çš„APIå“åº” {...}
[DataAnalysis] HTMLå›¾è¡¨å·²ä¿å­˜åˆ°localStorageå’ŒsessionStorage
[å‰ç«¯æ—¥å¿—][æŠ¥å‘Šç”Ÿæˆ] å·²è®¾ç½® reportContent åˆ° store

åç«¯æ—¥å¿—ï¼š
[è¿è¥æ•°æ®åˆ†æ] å›¾è¡¨ç”ŸæˆæˆåŠŸ
[è¿è¥æ•°æ®åˆ†æ] å¯¹è¯æ¶ˆæ¯å·²ä¿å­˜åˆ°ä¼šè¯
[è¿è¥æ•°æ®åˆ†æ] éªŒè¯ä¿å­˜: html_chartså·²ä¿å­˜=True
```

### åˆ·æ–°é¡µé¢
```
å‰ç«¯æ§åˆ¶å°ï¼š
[DataAnalysis] é¡µé¢åˆ·æ–°ï¼Œè‡ªåŠ¨åŠ è½½å½“å‰ä¼šè¯: 123
[DataAnalysis] å¼€å§‹åŠ è½½ä¼šè¯è¯¦æƒ…: 123
[DataAnalysis] ä»åç«¯æ•°æ®åº“æ¢å¤HTMLå›¾è¡¨ï¼Œé•¿åº¦: 12345
[DataAnalysis] å†å²ä¼šè¯åŠ è½½å®Œæˆ

åç«¯æ—¥å¿—ï¼š
[è¿è¥æ•°æ®åˆ†æ] è·å–ä¼šè¯è¯¦æƒ…æˆåŠŸ
[è¿è¥æ•°æ®åˆ†æ] æ¶ˆæ¯1 (assistant) - åŒ…å«html_charts: True
```

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥å‘½ä»¤

åœ¨PowerShellä¸­ä¸€é”®æ£€æŸ¥æ‰€æœ‰å…³é”®æ—¥å¿—ï¼š

```powershell
# æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®ä¿å­˜
docker logs operation-analysis-v2-backend --tail 200 | Select-String "éªŒè¯ä¿å­˜"

# æ£€æŸ¥åç«¯æ˜¯å¦è¿”å›html_charts
docker logs operation-analysis-v2-backend --tail 200 | Select-String "html_charts æ˜¯å¦å­˜åœ¨"

# æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
docker ps --filter "name=backend" --format "table {{.Names}}\t{{.Status}}"
```

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ä¸€é”®æ£€æŸ¥ï¼š

```javascript
// æ£€æŸ¥StoreçŠ¶æ€
console.log('Storeä¸­çš„html_charts:', !!window.$pinia?.state?.value?.operation?.reportContent?.html_charts)

// æ£€æŸ¥sessionStorage
console.log('sessionStorageä¸­çš„html_chartsé”®:', Object.keys(sessionStorage).filter(k => k.includes('html_charts')))

// æ£€æŸ¥localStorage
console.log('localStorageä¸­çš„html_chartsé”®:', Object.keys(localStorage).filter(k => k.includes('html_charts')))
```
