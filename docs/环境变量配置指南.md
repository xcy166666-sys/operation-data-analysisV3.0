# ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [ç¯å¢ƒå˜é‡è¯¦è§£](#ç¯å¢ƒå˜é‡è¯¦è§£)
3. [é…ç½®æ­¥éª¤](#é…ç½®æ­¥éª¤)
4. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šåˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# Windows PowerShell
Copy-Item .env.example .env

# Linux/Mac
cp .env.example .env
```

### æ­¥éª¤2ï¼šä¿®æ”¹å¿…éœ€é…ç½®

ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `.env` æ–‡ä»¶ï¼Œ**å¿…é¡»ä¿®æ”¹**ä»¥ä¸‹é…ç½®ï¼š

```env
# âš ï¸ å¿…é¡»ä¿®æ”¹çš„é…ç½®
POSTGRES_PASSWORD=your_secure_password_here        # æ•°æ®åº“å¯†ç ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your_random_jwt_secret_key_here         # JWTå¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
```

### æ­¥éª¤3ï¼šé…ç½®Difyï¼ˆå¦‚æœä½¿ç”¨ï¼‰

```env
DIFY_API_KEY=your_dify_api_key_here                # Dify APIå¯†é’¥
DIFY_API_URL=https://api.dify.ai/v1                # Dify APIåœ°å€
```

## ğŸ“ ç¯å¢ƒå˜é‡è¯¦è§£

### 1. åº”ç”¨é…ç½®

```env
# åº”ç”¨åç§°
APP_NAME=è¿è¥æ•°æ®åˆ†æç³»ç»Ÿ

# åº”ç”¨ç‰ˆæœ¬
APP_VERSION=1.0.0

# è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒè®¾ä¸º falseï¼‰
DEBUG=false

# æ—¥å¿—çº§åˆ«ï¼ˆDEBUG, INFO, WARNING, ERRORï¼‰
LOG_LEVEL=INFO
```

**è¯´æ˜**ï¼š
- `DEBUG=false`ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ä¸º `false`ï¼Œå¦åˆ™ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯
- `LOG_LEVEL`ï¼šå»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `INFO` æˆ– `WARNING`

### 2. æ•°æ®åº“é…ç½®

```env
# PostgreSQLç”¨æˆ·åï¼ˆé»˜è®¤ï¼špostgresï¼‰
POSTGRES_USER=postgres

# PostgreSQLå¯†ç ï¼ˆâš ï¸ å¿…é¡»ä¿®æ”¹ï¼‰
POSTGRES_PASSWORD=your_secure_password_here

# æ•°æ®åº“åç§°ï¼ˆé»˜è®¤ï¼šoperation_analysisï¼‰
POSTGRES_DB=operation_analysis

# æ•°æ®åº“è¿æ¥URLï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼‰
# DATABASE_URL=postgresql://postgres:password@postgres:5432/operation_analysis
```

**è¯´æ˜**ï¼š
- `POSTGRES_PASSWORD`ï¼š**å¿…é¡»ä¿®æ”¹**ä¸ºå¼ºå¯†ç ï¼ˆè‡³å°‘12ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
- `DATABASE_URL`ï¼šDocker Composeä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨é…ç½®
- å¦‚æœä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½® `DATABASE_URL`

**å¯†ç å®‰å…¨å»ºè®®**ï¼š
```bash
# ç”Ÿæˆéšæœºå¯†ç ï¼ˆLinux/Macï¼‰
openssl rand -base64 32

# ç”Ÿæˆéšæœºå¯†ç ï¼ˆPowerShellï¼‰
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 32 | % {[char]$_})
```

### 3. Redisé…ç½®

```env
# Redisè¿æ¥URLï¼ˆé»˜è®¤ï¼šredis://redis:6379/0ï¼‰
REDIS_URL=redis://redis:6379/0

# Rediså¯†ç ï¼ˆå¦‚æœRedisè®¾ç½®äº†å¯†ç ï¼‰
REDIS_PASSWORD=
```

**è¯´æ˜**ï¼š
- é»˜è®¤é…ç½®é€‚ç”¨äºDocker Composeç¯å¢ƒ
- å¦‚æœä½¿ç”¨å¤–éƒ¨Redisï¼Œéœ€è¦ä¿®æ”¹ `REDIS_URL`
- å¦‚æœRedisè®¾ç½®äº†å¯†ç ï¼Œéœ€è¦é…ç½® `REDIS_PASSWORD`

### 4. JWTé…ç½®

```env
# JWTå¯†é’¥ï¼ˆâš ï¸ å¿…é¡»ä¿®æ”¹ï¼Œå»ºè®®ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your_random_jwt_secret_key_here

# JWTç®—æ³•ï¼ˆé»˜è®¤ï¼šHS256ï¼‰
JWT_ALGORITHM=HS256

# Tokenè¿‡æœŸæ—¶é—´ï¼ˆå°æ—¶ï¼Œé»˜è®¤ï¼š24ï¼‰
JWT_EXPIRE_HOURS=24
```

**è¯´æ˜**ï¼š
- `JWT_SECRET`ï¼š**å¿…é¡»ä¿®æ”¹**ï¼Œç”¨äºç­¾åå’ŒéªŒè¯JWT Token
- å»ºè®®ä½¿ç”¨è‡³å°‘32ä½çš„éšæœºå­—ç¬¦ä¸²
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºå¯†é’¥

**ç”ŸæˆJWTå¯†é’¥**ï¼š
```bash
# Linux/Mac
openssl rand -hex 32

# PowerShell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 64 | % {[char]$_})
```

### 5. Sessioné…ç½®

```env
# Sessionå¯†é’¥ï¼ˆâš ï¸ å»ºè®®ä¿®æ”¹ï¼‰
SESSION_SECRET=your_random_session_secret_key_here

# Sessionè¿‡æœŸæ—¶é—´ï¼ˆå°æ—¶ï¼Œé»˜è®¤ï¼š24ï¼‰
SESSION_EXPIRE_HOURS=24
```

**è¯´æ˜**ï¼š
- `SESSION_SECRET`ï¼šç”¨äºåŠ å¯†Sessionæ•°æ®
- å»ºè®®ä¸ `JWT_SECRET` ä½¿ç”¨ä¸åŒçš„å€¼

### 6. Difyé…ç½®ï¼ˆå¯é€‰ï¼‰

```env
# Dify APIå¯†é’¥ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯é€šè¿‡ç®¡ç†ç•Œé¢é…ç½®ï¼‰
DIFY_API_KEY=your_dify_api_key_here

# Dify APIåœ°å€ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯é€šè¿‡ç®¡ç†ç•Œé¢é…ç½®ï¼‰
DIFY_API_URL=https://api.dify.ai/v1
```

**è¯´æ˜**ï¼š
- è¿™äº›é…ç½®æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿç®¡ç†ç•Œé¢é…ç½®
- å¦‚æœåœ¨è¿™é‡Œé…ç½®ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½
- æ¨èåœ¨ç®¡ç†ç•Œé¢é…ç½®ï¼Œä¾¿äºåŠ¨æ€æ›´æ–°

**è·å–Dify APIå¯†é’¥**ï¼š
1. ç™»å½•Difyå¹³å°
2. è¿›å…¥"è®¾ç½®" -> "APIå¯†é’¥"
3. åˆ›å»ºæ–°çš„APIå¯†é’¥
4. å¤åˆ¶å¯†é’¥åˆ° `.env` æ–‡ä»¶

### 7. CORSé…ç½®

```env
# å…è®¸çš„è·¨åŸŸæ¥æºï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰
CORS_ORIGINS=http://localhost:80,http://localhost:5173,http://localhost:3000

# æ˜¯å¦å…è®¸æºå¸¦å‡­è¯
CORS_ALLOW_CREDENTIALS=true
```

**è¯´æ˜**ï¼š
- `CORS_ORIGINS`ï¼šé…ç½®å…è®¸è®¿é—®çš„å‰ç«¯åœ°å€
- ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®å®é™…çš„å‰ç«¯åŸŸå
- å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ï¼Œä¸è¦æœ‰ç©ºæ ¼

**ç”Ÿäº§ç¯å¢ƒç¤ºä¾‹**ï¼š
```env
CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

### 8. æ–‡ä»¶ä¸Šä¼ é…ç½®

```env
# æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼Œé»˜è®¤ï¼š20MBï¼‰
MAX_UPLOAD_SIZE=20971520

# ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼ˆé»˜è®¤ï¼š/app/uploadsï¼‰
UPLOAD_DIR=/app/uploads
```

**è¯´æ˜**ï¼š
- `MAX_UPLOAD_SIZE`ï¼š20MB = 20971520 å­—èŠ‚
- æ‰¹é‡åˆ†æéœ€è¦è¾ƒå¤§çš„æ–‡ä»¶å¤§å°é™åˆ¶
- å¦‚æœéœ€è¦æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹Nginxé…ç½®

### 9. ç®¡ç†å‘˜é»˜è®¤é…ç½®

```env
# é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·å
DEFAULT_ADMIN_USERNAME=admin

# é»˜è®¤ç®¡ç†å‘˜å¯†ç ï¼ˆåˆ›å»ºåˆå§‹ç”¨æˆ·æ—¶ä½¿ç”¨ï¼‰
DEFAULT_ADMIN_PASSWORD=admin123!

# é»˜è®¤ç®¡ç†å‘˜é‚®ç®±
DEFAULT_ADMIN_EMAIL=admin@example.com
```

**è¯´æ˜**ï¼š
- è¿™äº›é…ç½®ç”¨äºåˆ›å»ºåˆå§‹ç®¡ç†å‘˜ç”¨æˆ·
- åˆ›å»ºåå»ºè®®ç«‹å³ä¿®æ”¹å¯†ç 
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹é»˜è®¤å¯†ç 

### 10. æ—¥å¿—é…ç½®

```env
# æ—¥å¿—æ–‡ä»¶è·¯å¾„
LOG_FILE=/var/log/operation-analysis/app.log

# æ—¥å¿—è½®è½¬å¤§å°ï¼ˆé»˜è®¤ï¼š10MBï¼‰
LOG_ROTATION=10 MB

# æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆé»˜è®¤ï¼š30å¤©ï¼‰
LOG_RETENTION=30 days
```

## ğŸ”§ é…ç½®æ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€ `.env.example` æ–‡ä»¶**
   ```bash
   # Windows
   notepad .env.example
   
   # Linux/Mac
   nano .env.example
   # æˆ–
   vim .env.example
   ```

2. **å¤åˆ¶å†…å®¹åˆ°æ–°æ–‡ä»¶ `.env`**
   - å°† `.env.example` çš„å†…å®¹å¤åˆ¶åˆ° `.env`
   - ä¿®æ”¹å¿…éœ€é…ç½®é¡¹

3. **ä¿å­˜æ–‡ä»¶**

### æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆWindows PowerShellï¼‰

```powershell
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
Copy-Item .env.example .env

# ç¼–è¾‘æ–‡ä»¶ï¼ˆä½¿ç”¨è®°äº‹æœ¬ï¼‰
notepad .env

# æˆ–ä½¿ç”¨VS Code
code .env
```

### æ–¹æ³•3ï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆLinux/Macï¼‰

```bash
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘æ–‡ä»¶
nano .env
# æˆ–
vim .env
```

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

åœ¨å¯åŠ¨æœåŠ¡å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é…ç½®ï¼š

- [ ] `POSTGRES_PASSWORD` å·²ä¿®æ”¹ä¸ºå¼ºå¯†ç 
- [ ] `JWT_SECRET` å·²ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²
- [ ] `SESSION_SECRET` å·²ä¿®æ”¹ï¼ˆå»ºè®®ï¼‰
- [ ] `DEBUG=false`ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] `CORS_ORIGINS` å·²é…ç½®æ­£ç¡®çš„å‰ç«¯åœ°å€
- [ ] `DIFY_API_KEY` å·²é…ç½®ï¼ˆå¦‚æœä½¿ç”¨Difyï¼‰
- [ ] æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å·²ä¿®æ”¹

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. å¯†ç å®‰å…¨

- âœ… ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘12ä½ï¼‰
- âœ… åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- âœ… ä¸è¦ä½¿ç”¨å¸¸è§å¯†ç 
- âœ… å®šæœŸæ›´æ¢å¯†ç 

### 2. å¯†é’¥å®‰å…¨

- âœ… `JWT_SECRET` å’Œ `SESSION_SECRET` ä½¿ç”¨éšæœºå­—ç¬¦ä¸²
- âœ… ä¸è¦å°†å¯†é’¥æäº¤åˆ°Gitä»“åº“
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥

### 3. æ–‡ä»¶æƒé™

```bash
# Linux/Macï¼šè®¾ç½®.envæ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
chmod 600 .env

# ç¡®ä¿.envåœ¨.gitignoreä¸­
```

### 4. ç¯å¢ƒéš”ç¦»

- âœ… å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®
- âœ… ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼€å‘é…ç½®
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·ï¼ˆå¦‚Vaultï¼‰

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç”Ÿæˆéšæœºå¯†ç ï¼Ÿ

**Windows PowerShell**ï¼š
```powershell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 32 | % {[char]$_})
```

**Linux/Mac**ï¼š
```bash
openssl rand -base64 32
```

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥ `POSTGRES_PASSWORD` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ `POSTGRES_USER` å’Œ `POSTGRES_DB` æ˜¯å¦åŒ¹é…
3. ç¡®è®¤PostgreSQLå®¹å™¨å·²å¯åŠ¨ï¼š`docker-compose ps postgres`
4. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—ï¼š`docker-compose logs postgres`

### Q3: JWT Tokenæ— æ•ˆæ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥ `JWT_SECRET` æ˜¯å¦æ­£ç¡®é…ç½®
2. ç¡®è®¤Tokenæœªè¿‡æœŸï¼ˆæ£€æŸ¥ `JWT_EXPIRE_HOURS`ï¼‰
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookieï¼Œé‡æ–°ç™»å½•

### Q4: CORSé”™è¯¯æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥ `CORS_ORIGINS` æ˜¯å¦åŒ…å«å‰ç«¯åœ°å€
2. ç¡®è®¤å‰ç«¯åœ°å€æ ¼å¼æ­£ç¡®ï¼ˆåŒ…å«åè®®ï¼Œå¦‚ `http://` æˆ– `https://`ï¼‰
3. å¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”ï¼Œä¸è¦æœ‰ç©ºæ ¼

### Q5: æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Ÿ

1. æ£€æŸ¥ `MAX_UPLOAD_SIZE` æ˜¯å¦è¶³å¤Ÿå¤§
2. ç¡®è®¤Nginxé…ç½®ä¸­çš„ `client_max_body_size` ä¹Ÿè¶³å¤Ÿå¤§
3. æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™

### Q6: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®ï¼Ÿ

**æ–¹æ³•1ï¼šä½¿ç”¨å¤šä¸ª.envæ–‡ä»¶**
```bash
.env.development    # å¼€å‘ç¯å¢ƒ
.env.production     # ç”Ÿäº§ç¯å¢ƒ
.env.testing        # æµ‹è¯•ç¯å¢ƒ
```

**æ–¹æ³•2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–**
```bash
# åœ¨docker-compose.ymlä¸­
environment:
  - DEBUG=false
  - LOG_LEVEL=WARNING
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- [README.md](./README.md) - é¡¹ç›®è¯´æ˜
- [æå–å®Œæˆæ€»ç»“.md](./æå–å®Œæˆæ€»ç»“.md) - åŠŸèƒ½è¯´æ˜

## ğŸ”— å¤–éƒ¨æœåŠ¡é…ç½®

### Difyé…ç½®

1. **è·å–APIå¯†é’¥**
   - ç™»å½•Difyå¹³å°
   - è¿›å…¥"è®¾ç½®" -> "APIå¯†é’¥"
   - åˆ›å»ºæ–°å¯†é’¥

2. **é…ç½®å·¥ä½œæµ**
   - åœ¨Difyä¸­åˆ›å»ºå·¥ä½œæµ
   - è·å–å·¥ä½œæµID
   - åœ¨ç³»ç»Ÿç®¡ç†ç•Œé¢é…ç½®å·¥ä½œæµç»‘å®š

### å¤–éƒ¨æ•°æ®åº“é…ç½®

å¦‚æœä½¿ç”¨å¤–éƒ¨PostgreSQLæ•°æ®åº“ï¼š

```env
DATABASE_URL=postgresql://username:password@host:port/database_name
```

ç¤ºä¾‹ï¼š
```env
DATABASE_URL=postgresql://myuser:mypass@db.example.com:5432/operation_analysis
```

### å¤–éƒ¨Redisé…ç½®

å¦‚æœä½¿ç”¨å¤–éƒ¨Redisï¼š

```env
REDIS_URL=redis://username:password@host:port/database
```

ç¤ºä¾‹ï¼š
```env
REDIS_URL=redis://:mypassword@redis.example.com:6379/0
```

---

**é…ç½®å®Œæˆåï¼Œè¯·å‚è€ƒ [éƒ¨ç½²æŒ‡å—.md](./éƒ¨ç½²æŒ‡å—.md) å¯åŠ¨æœåŠ¡ã€‚**

