# 图表AI编辑功能 - 第一阶段实施

## 实施范围

根据完整设计方案，第一阶段（2-3周）实现基础功能：

### 核心功能
1. ✅ 图表悬停工具栏
2. ✅ 图表选中状态管理
3. ✅ 快捷操作面板（颜色、类型）
4. ✅ AI对话修改集成
5. ✅ 基础视觉反馈

### 技术实现
1. ✅ 图表配置数据结构
2. ✅ 配置存储和读取
3. ✅ AI指令理解接口
4. ✅ 配置修改应用逻辑

## 当前系统分析

### 现状
- 图表通过iframe展示HTML内容
- HTML由AI生成，存储在数据库
- 缺少结构化配置
- 无法动态修改

### 挑战
由于当前系统使用iframe展示静态HTML，我们需要：
1. 在生成阶段同时保存配置JSON
2. 修改时基于配置重新渲染
3. 或者解析HTML提取配置（复杂度高）

## 简化方案（MVP）

考虑到当前架构，我们采用**渐进式实现**：

### 阶段1A：基础交互（本次实施）
- 图表悬停显示工具栏
- 点击进入编辑模式
- 通过AI对话修改
- AI重新生成HTML

### 阶段1B：配置化（后续优化）
- 修改生成逻辑，同时保存配置
- 基于配置渲染
- 精确修改

## 本次实施内容

### 1. 前端组件开发

#### 1.1 图表容器组件增强
文件：`frontend/src/components/ChartContainer.vue`（新建）

功能：
- 包装图表展示
- 悬停显示工具栏
- 选中状态管理
- 事件传递

#### 1.2 图表编辑工具栏
文件：`frontend/src/components/ChartEditToolbar.vue`（新建）

功能：
- 快捷操作按钮
- AI修改入口
- 视觉反馈

#### 1.3 DataAnalysis页面集成
文件：`frontend/src/views/Operation/DataAnalysis.vue`（修改）

功能：
- 集成图表容器
- 管理选中状态
- 连接AI对话

### 2. 后端API开发

#### 2.1 图表修改API
文件：`backend/app/api/v1/operation.py`（修改）

接口：`POST /api/v1/operation/charts/{chart_id}/modify`

功能：
- 接收修改指令
- AI理解意图
- 重新生成HTML
- 返回新内容

### 3. AI服务增强

#### 3.1 图表修改服务
文件：`backend/app/services/chart_modification_service.py`（新建）

功能：
- 理解修改指令
- 生成修改后的HTML
- 保持上下文

## 实施步骤

### Step 1: 创建图表容器组件（30分钟）
- [ ] 创建ChartContainer.vue
- [ ] 实现悬停工具栏
- [ ] 实现选中状态

### Step 2: 创建编辑工具栏（30分钟）
- [ ] 创建ChartEditToolbar.vue
- [ ] 实现快捷按钮
- [ ] 实现事件处理

### Step 3: 集成到DataAnalysis（1小时）
- [ ] 修改报告展示逻辑
- [ ] 包装图表为容器
- [ ] 连接AI对话

### Step 4: 后端API开发（1小时）
- [ ] 创建修改接口
- [ ] 实现AI调用
- [ ] 返回新HTML

### Step 5: 测试与优化（1小时）
- [ ] 功能测试
- [ ] 交互优化
- [ ] Bug修复

## 预期效果

用户可以：
1. 鼠标悬停在图表上看到工具栏
2. 点击"AI修改"打开对话
3. 输入修改指令（如"改成蓝色"）
4. AI重新生成图表
5. 实时看到修改效果

## 下一步

完成第一阶段后，我们将：
1. 收集用户反馈
2. 优化交互体验
3. 准备第二阶段（配置化）

---

**开始时间：** 2025-12-24
**预计完成：** 2025-12-24（4小时）
**负责人：** 开发团队
