# AI编辑功能 - 快速测试指南

## 🚀 快速开始

### 1. 确认服务运行
```bash
# 检查后端（应该在 http://localhost:8000）
# 检查前端（应该在 http://localhost:5173）
```

### 2. 登录系统
- 打开浏览器访问：http://localhost:5173
- 账号：`123123`
- 密码：`123132`

### 3. 打开一个报告
- 点击左侧历史会话列表
- 选择任意一个已有的会话（例如："LTV - 副本 (2)"）
- 等待报告加载完成

### 4. 测试文本AI编辑

#### 步骤1：打开浏览器控制台
- 按 `F12` 打开开发者工具
- 切换到 `Console` 标签

#### 步骤2：检查组件是否挂载
在控制台中应该看到：
```
[TextEditToolbar] 组件已挂载，开始监听文本选择
```

如果没有看到，说明组件没有正确挂载。

#### 步骤3：选中文字
- 在报告的文字内容区域，用鼠标选中一段文字
- 例如选中："好的，我现在需要处理用户提供的数据样本"

#### 步骤4：查看工具栏
- 选中文字后，应该会在选区上方弹出一个浮动工具栏
- 工具栏包含：
  - 输入框
  - "提交"按钮
  - "取消"按钮
  - 快捷按钮："润色"、"简化"、"扩写"

#### 步骤5：使用快捷按钮
- 点击"润色"按钮
- 输入框会自动填充："润色这段话"
- 点击"提交"按钮

#### 步骤6：等待AI处理
- 按钮会显示"处理中..."
- 控制台会显示：
  ```
  [TextEditToolbar] 发送AI请求
  ```

#### 步骤7：查看结果
- AI处理完成后，选中的文字会被自动替换
- 会显示成功提示："文本修改成功"

## 🔍 调试检查清单

### ✅ 前端检查

1. **组件是否挂载？**
   - 打开控制台
   - 查找：`[TextEditToolbar] 组件已挂载`
   - ❌ 如果没有：检查 `DataAnalysis.vue` 中是否正确导入和使用组件

2. **选中文字是否触发事件？**
   - 选中文字后
   - 查找：`[TextEditToolbar] 上下文提取成功`
   - ❌ 如果没有：检查选中的文字是否在 `.report-text` 元素内

3. **工具栏是否显示？**
   - 选中文字后应该看到浮动工具栏
   - ❌ 如果没有：
     - 检查 `visible` 状态是否为 `true`
     - 检查工具栏的 `z-index` 是否足够高
     - 检查是否有CSS冲突

4. **API调用是否成功？**
   - 点击提交后
   - 查找：`[TextEditToolbar] 发送AI请求`
   - 查找：`[TextEditToolbar] 修改成功`
   - ❌ 如果失败：检查网络请求和后端日志

### ✅ 后端检查

1. **API路由是否存在？**
   ```bash
   # 检查 backend/app/api/v1/operation.py
   # 应该有：@router.post("/ai/text-edit")
   ```

2. **后端日志**
   - 查看后端控制台
   - 应该看到：`[AI文本编辑] 用户=...`
   - ❌ 如果没有：说明请求没有到达后端

3. **AI服务配置**
   - 检查 `.env` 文件
   - 确认 `DASHSCOPE_API_KEY` 已配置
   - ❌ 如果没有：AI调用会失败

## 🐛 常见问题排查

### 问题1：工具栏不显示

**检查步骤：**
1. 打开控制台，查看是否有错误
2. 检查是否有挂载日志
3. 尝试在控制台执行：
   ```javascript
   document.querySelector('.report-text')
   ```
   应该返回一个元素，而不是 `null`

4. 检查选中的文字是否在正确的元素内：
   ```javascript
   const selection = window.getSelection()
   const text = selection.toString()
   console.log('选中的文字:', text)
   console.log('选中的元素:', selection.anchorNode.parentElement)
   ```

### 问题2：API调用失败

**检查步骤：**
1. 打开浏览器的 Network 标签
2. 选中文字并提交
3. 查找 `/api/v1/ai/text-edit` 请求
4. 检查请求状态：
   - 200：成功
   - 401：未登录
   - 500：服务器错误

5. 查看请求详情：
   - Request Payload：检查发送的数据
   - Response：检查返回的数据

### 问题3：文本替换失败

**检查步骤：**
1. 查看控制台错误信息
2. 检查是否有：`[TextEditToolbar] 文本替换失败`
3. 可能原因：
   - 选区信息丢失
   - DOM结构变化
   - 权限问题

**解决方法：**
- 刷新页面重试
- 检查是否有其他脚本修改了DOM

## 📊 测试用例

### 用例1：润色文字
1. 选中："VIP用户的rmb_ltv比较高"
2. 点击"润色"
3. 预期结果：文字变得更专业，例如："VIP等级用户的生命周期价值（LTV）显著高于其他用户群体"

### 用例2：简化表达
1. 选中一段复杂的分析文字
2. 点击"简化"
3. 预期结果：文字变得更简洁易懂

### 用例3：扩写内容
1. 选中："建议优化新手引导"
2. 点击"扩写"
3. 预期结果：增加更多细节和建议

### 用例4：自定义指令
1. 选中任意文字
2. 在输入框输入："翻译成英文"
3. 点击"提交"
4. 预期结果：文字被翻译成英文

## 🎯 成功标准

- ✅ 选中文字后工具栏正常显示
- ✅ 快捷按钮功能正常
- ✅ 自定义指令功能正常
- ✅ AI处理速度在5-15秒内
- ✅ 文字替换准确无误
- ✅ 没有JavaScript错误
- ✅ 用户体验流畅

## 📝 测试记录模板

```
测试时间：____________________
测试人员：____________________

【测试环境】
- 浏览器：____________________
- 前端版本：__________________
- 后端版本：__________________

【测试结果】
1. 组件挂载：□ 成功  □ 失败
2. 工具栏显示：□ 成功  □ 失败
3. 润色功能：□ 成功  □ 失败
4. 简化功能：□ 成功  □ 失败
5. 扩写功能：□ 成功  □ 失败
6. 自定义指令：□ 成功  □ 失败
7. 文字替换：□ 成功  □ 失败

【问题记录】
____________________________________
____________________________________
____________________________________

【建议】
____________________________________
____________________________________
____________________________________
```

---

**祝测试顺利！** 🎉
