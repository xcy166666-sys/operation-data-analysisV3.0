# 图表AI编辑功能 - README

## 📖 功能概述

图表AI编辑功能允许用户通过简单的交互方式修改报告中的图表，无需编写代码或手动调整配置。支持三种编辑方式：

1. **快捷编辑** - 一键改颜色、换类型
2. **AI自由修改** - 自然语言描述修改需求
3. **AI对话模式** - 连续对话式修改

## 🎯 核心特性

### 1. 多层次入口设计
- **悬停工具栏** - 鼠标悬停图表时显示
- **快捷按钮** - 改颜色、换类型、AI修改
- **对话面板** - 支持连续修改和复杂指令

### 2. 即时反馈
- 选中状态高亮显示
- 修改过程加载动画
- 成功/失败消息提示
- 新手引导提示

### 3. AI驱动
- 理解自然语言指令
- 保持数据不变
- 智能样式调整
- 支持复杂组合修改

## 📁 文档导航

### 快速开始
- **[快速开始指南](./图表AI编辑功能-快速开始.md)** - 5分钟快速体验
- **[测试指南](./图表AI编辑功能-测试指南.md)** - 完整测试清单

### 设计文档
- **[完整设计方案](./图表AI编辑功能-完整设计方案.md)** - 产品与技术设计
- **[第一阶段实施](./图表AI编辑功能-第一阶段实施.md)** - 实施计划

### 开发文档
- **[已完成工作](./图表AI编辑功能-已完成工作.md)** - 开发进度和技术细节

## 🏗️ 技术架构

### 前端组件
```
ChartContainer.vue          # 图表容器，处理悬停和选中
ChartQuickEditPanel.vue     # 快捷编辑面板
DataAnalysis.vue            # 主页面集成
```

### 后端服务
```
/api/v1/operation/charts/modify    # 图表修改API
ChartModificationService           # AI修改服务
```

### 数据流
```
用户操作 → 前端组件 → API请求 → AI处理 → 返回新HTML → 更新界面
```

## 🚀 快速开始

### 1. 启动系统
```bash
# 后端
cd backend && .\start_local.bat

# 前端
cd frontend && npm run dev
```

### 2. 生成报告
1. 登录系统（admin / admin123!）
2. 上传Excel文件
3. 输入分析需求
4. 生成包含图表的报告

### 3. 编辑图表
1. 悬停图表查看工具栏
2. 点击"改颜色"或"换类型"
3. 或使用"AI修改"输入自定义指令
4. 等待修改完成

## 💡 使用示例

### 示例1：改颜色
```
1. 悬停图表
2. 点击"改颜色"
3. 选择绿色 #67c23a
4. 应用修改
```

### 示例2：换类型
```
1. 悬停图表
2. 点击"换类型"
3. 选择"折线图"
4. 应用修改
```

### 示例3：AI修改
```
1. 悬停图表
2. 点击"AI修改"
3. 输入："改成渐变色，从蓝色到绿色，添加数据标签"
4. 应用修改
```

## 📊 开发进度

- [x] 设计文档（100%）
- [x] 前端组件（100%）
- [x] 页面集成（100%）
- [x] 后端API（100%）
- [x] AI服务（100%）
- [ ] 测试验证（待进行）

**总体进度：** 90%（待测试）

## 🧪 测试清单

- [ ] 悬停工具栏显示
- [ ] 图表选中状态
- [ ] 快捷编辑 - 改颜色
- [ ] 快捷编辑 - 换类型
- [ ] AI自由修改
- [ ] 组合修改
- [ ] AI对话模式
- [ ] 错误处理
- [ ] 性能测试
- [ ] 兼容性测试

详见：[测试指南](./图表AI编辑功能-测试指南.md)

## 🎨 设计亮点

### 1. 渐进式交互
- 新手：快捷按钮（改颜色、换类型）
- 进阶：AI自由修改
- 高级：AI对话模式

### 2. 即时反馈
- 悬停高亮
- 选中徽章
- 加载动画
- 成功提示

### 3. 智能引导
- 首次悬停提示
- 操作说明
- 错误提示
- 示例参考

## 🔧 技术细节

### 前端技术栈
- Vue 3 + TypeScript
- Element Plus UI
- Composition API
- Reactive State Management

### 后端技术栈
- FastAPI
- Python 3.9+
- 通义千问 API
- Async/Await

### AI Prompt设计
```python
"""
你是一个图表修改专家。用户想要修改现有的图表，
请根据用户的指令重新生成HTML代码。

当前图表HTML：
{current_html}

用户修改指令：
{instruction}

要求：
1. 保持图表的数据不变
2. 应用用户要求的样式修改
3. 确保HTML代码完整可运行
4. 使用ECharts图表库
5. 包含必要的CSS和JavaScript

直接返回HTML代码，不要有其他说明文字。
"""
```

## 📝 API文档

### POST /api/v1/operation/charts/modify

**请求参数：**
```typescript
{
  session_id: number        // 会话ID
  current_html: string      // 当前图表HTML
  color?: string           // 颜色修改（可选）
  chart_type?: string      // 图表类型（可选）
  ai_instruction?: string  // AI指令（可选）
}
```

**响应：**
```typescript
{
  success: boolean
  data: {
    html: string  // 新的图表HTML
  }
  message: string
}
```

## 🐛 已知问题

暂无（待测试发现）

## 🔮 未来规划

### 短期（本周）
- [ ] 完成功能测试
- [ ] 优化AI Prompt
- [ ] 添加修改历史
- [ ] 实现撤销功能

### 中期（下周）
- [ ] 配置化存储
- [ ] 批量修改
- [ ] 更多图表类型
- [ ] 性能优化

### 长期（下月）
- [ ] 图表模板库
- [ ] 样式预设
- [ ] 协作编辑
- [ ] 版本管理

## 🤝 贡献指南

### 报告Bug
1. 使用测试指南中的Bug记录模板
2. 包含详细的复现步骤
3. 附上截图或日志
4. 标注严重程度

### 提出建议
1. 描述使用场景
2. 说明期望功能
3. 提供参考案例
4. 评估优先级

### 代码贡献
1. Fork项目
2. 创建功能分支
3. 提交Pull Request
4. 等待代码审查

## 📞 联系方式

- **技术支持：** [开发团队]
- **问题反馈：** [Issue Tracker]
- **文档更新：** [Documentation]

## 📄 许可证

[项目许可证信息]

---

## 🎉 开始使用

准备好体验图表AI编辑功能了吗？

👉 **[5分钟快速开始](./图表AI编辑功能-快速开始.md)**

---

**文档版本：** 1.0  
**创建时间：** 2025-12-24  
**最后更新：** 2025-12-24  
**维护者：** 开发团队
