# å›¾è¡¨æ˜¾ç¤ºé—®é¢˜ - è¯Šæ–­è„šæœ¬

## é—®é¢˜æè¿°
- åç«¯æ—¥å¿—æ˜¾ç¤ºHTMLå›¾è¡¨å·²ç”Ÿæˆï¼ˆé•¿åº¦6107å­—ç¬¦ï¼‰
- å‰ç«¯æ—¥å¿—æ˜¾ç¤º `reportContent.text` ä¸º `undefined`
- å›¾è¡¨æŒ‰é’®æ˜¾ç¤ºä½†ç‚¹å‡»åæ²¡æœ‰å›¾è¡¨

## è¯Šæ–­æ­¥éª¤

### 1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåœ¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```javascript
// 1. æ£€æŸ¥ store ä¸­çš„ reportContent
console.log('=== Store æ£€æŸ¥ ===')
const store = window.__PINIA_STORE__ || {}
console.log('Store keys:', Object.keys(store))

// 2. æ£€æŸ¥ Vue å®ä¾‹
console.log('=== Vue å®ä¾‹æ£€æŸ¥ ===')
const app = document.querySelector('#app').__vue_app__
console.log('App:', app)

// 3. æ£€æŸ¥ reportContent
console.log('=== ReportContent æ£€æŸ¥ ===')
// åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼ŒæŸ¥çœ‹å½“å‰çš„ reportContent
// æ³¨æ„ï¼šéœ€è¦åœ¨ DataAnalysis ç»„ä»¶ä¸­è¿è¡Œ
```

### 2. åœ¨å‰ç«¯ä»£ç ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `frontend/src/views/Operation/DataAnalysis.vue` çš„ `submitAnalysis` æ–¹æ³•ä¸­ï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼š

```typescript
operationStore.setReportContent(reportData.content)
```

åœ¨è¿™è¡Œ**ä¹‹å**æ·»åŠ ä»¥ä¸‹è°ƒè¯•ä»£ç ï¼š

```typescript
// è°ƒè¯•ï¼šç«‹å³æ£€æŸ¥ store ä¸­çš„å€¼
console.log('ğŸ”´ğŸ”´ğŸ”´ [è°ƒè¯•] setReportContent åç«‹å³æ£€æŸ¥:', {
  storeReportContent: operationStore.reportContent,
  storeReportContentKeys: operationStore.reportContent ? Object.keys(operationStore.reportContent) : [],
  storeText: operationStore.reportContent?.text,
  storeTextType: typeof operationStore.reportContent?.text,
  storeTextLength: operationStore.reportContent?.text?.length,
  storeHtmlCharts: operationStore.reportContent?.html_charts,
  storeHtmlChartsType: typeof operationStore.reportContent?.html_charts,
  storeHtmlChartsLength: operationStore.reportContent?.html_charts?.length,
  storeHtmlChartsPreview: operationStore.reportContent?.html_charts?.substring(0, 100)
})

// è°ƒè¯•ï¼šæ£€æŸ¥ computed çš„ reportContent
console.log('ğŸ”´ğŸ”´ğŸ”´ [è°ƒè¯•] computed reportContent:', {
  reportContent: reportContent.value,
  reportContentKeys: reportContent.value ? Object.keys(reportContent.value) : [],
  text: reportContent.value?.text,
  textType: typeof reportContent.value?.text,
  htmlCharts: reportContent.value?.html_charts,
  htmlChartsType: typeof reportContent.value?.html_charts,
  htmlChartsLength: reportContent.value?.html_charts?.length
})
```

### 3. æ£€æŸ¥ API å“åº”

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾ä¸­ï¼š
1. æ‰¾åˆ° `/api/v1/operation/generate` è¯·æ±‚
2. æŸ¥çœ‹ Response æ ‡ç­¾
3. æ£€æŸ¥è¿”å›çš„ JSON æ•°æ®ä¸­æ˜¯å¦åŒ…å« `html_charts` å­—æ®µ
4. æˆªå›¾æˆ–å¤åˆ¶ Response å†…å®¹

### 4. æ£€æŸ¥ watch ç›‘å¬å™¨

åœ¨ `frontend/src/views/Operation/DataAnalysis.vue` ä¸­ï¼Œæ‰¾åˆ°è¿™ä¸ª watchï¼š

```typescript
watch(() => reportContent.value?.text, async (newText) => {
  frontendLogger.log('Watch', 'reportContent.text å˜åŒ–', {
    hasText: !!newText,
    textType: typeof newText,
  })
  // ...
})
```

åœ¨è¿™ä¸ª watch ä¸­æ·»åŠ æ›´å¤šè°ƒè¯•ä¿¡æ¯ï¼š

```typescript
watch(() => reportContent.value?.text, async (newText) => {
  console.log('ğŸŸ¢ğŸŸ¢ğŸŸ¢ [Watch] reportContent.text å˜åŒ–:', {
    hasText: !!newText,
    textType: typeof newText,
    textLength: newText?.length,
    textPreview: newText?.substring(0, 100),
    fullReportContent: reportContent.value,
    hasHtmlCharts: !!reportContent.value?.html_charts,
    htmlChartsLength: reportContent.value?.html_charts?.length
  })
  // ...
})
```

### 5. æ£€æŸ¥ iframe æ¸²æŸ“

åœ¨æµè§ˆå™¨ä¸­ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ iframe å…ƒç´ ï¼š

```javascript
// åœ¨æ§åˆ¶å°è¿è¡Œ
const iframes = document.querySelectorAll('iframe.html-charts-iframe')
console.log('æ‰¾åˆ°çš„ iframe æ•°é‡:', iframes.length)
iframes.forEach((iframe, index) => {
  console.log(`iframe ${index}:`, {
    srcdoc: iframe.getAttribute('srcdoc')?.substring(0, 200),
    srcdocLength: iframe.getAttribute('srcdoc')?.length
  })
})
```

## é¢„æœŸç»“æœ

### æ­£å¸¸æƒ…å†µ
- API å“åº”ä¸­åº”è¯¥åŒ…å« `html_charts` å­—æ®µï¼Œé•¿åº¦çº¦ 6107
- `operationStore.reportContent.html_charts` åº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼Œé•¿åº¦çº¦ 6107
- `reportContent.value.html_charts` åº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼Œé•¿åº¦çº¦ 6107
- iframe çš„ `srcdoc` å±æ€§åº”è¯¥åŒ…å« HTML å†…å®¹

### å¼‚å¸¸æƒ…å†µ
å¦‚æœä»¥ä¸Šä»»ä½•ä¸€é¡¹ä¸ç¬¦åˆé¢„æœŸï¼Œè¯´æ˜æ•°æ®åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚

## ä¸‹ä¸€æ­¥

æ ¹æ®è¯Šæ–­ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šé—®é¢˜å‡ºåœ¨å“ªä¸ªç¯èŠ‚ï¼š
1. **API å“åº”é—®é¢˜**ï¼šåç«¯æ²¡æœ‰æ­£ç¡®è¿”å› `html_charts`
2. **Store è®¾ç½®é—®é¢˜**ï¼š`setReportContent` æ²¡æœ‰æ­£ç¡®ä¿å­˜æ•°æ®
3. **Computed é—®é¢˜**ï¼šcomputed çš„ `reportContent` æ²¡æœ‰æ­£ç¡®è¯»å– store
4. **æ¸²æŸ“é—®é¢˜**ï¼šæ•°æ®æ­£ç¡®ä½† iframe æ²¡æœ‰æ­£ç¡®æ¸²æŸ“
