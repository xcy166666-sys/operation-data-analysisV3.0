# 图表编辑器 - 全屏模式设计方案

## 🎯 设计目标

1. **专业的编辑体验** - 类似专业图表工具的全屏编辑界面
2. **即时反馈** - 本地修改立即生效（< 100ms）
3. **渐进式功能** - 简单操作在前，复杂功能在后
4. **明确的进入/退出** - 用户主动选择进入编辑模式

---

## 🎨 交互流程

### 流程1：进入编辑模式

```
报告页面
    ↓
用户点击图表
    ↓
弹出确认对话框
    ↓
用户点击"进入编辑"
    ↓
全屏编辑模式（带动画过渡）
```

### 流程2：编辑和保存

```
全屏编辑模式
    ↓
用户修改图表（即时预览）
    ↓
点击"应用修改"（本地处理）
    ↓
或点击"AI修改"（AI处理）
    ↓
点击"保存"返回报告页面
```

### 流程3：取消编辑

```
全屏编辑模式
    ↓
用户点击"取消"或"返回报告"
    ↓
弹出确认对话框（如果有未保存的修改）
    ↓
返回报告页面
```

---

## 🖼️ 界面布局

### 整体布局（三栏式）

```
┌────────────────────────────────────────────────────────────────┐
│  顶部工具栏（固定）                                              │
│  [← 返回报告]  图表编辑器 - 用户活跃度分析    [保存] [取消]      │
├──────────────┬─────────────────────────────────┬───────────────┤
│              │                                 │               │
│  左侧工具栏   │        中间预览区                │  右侧属性面板  │
│  (240px)     │        (自适应)                 │  (320px)      │
│              │                                 │               │
│  可折叠分组   │    实时预览图表                  │  详细配置项    │
│              │    支持缩放和拖拽                │  分组展示      │
│              │                                 │               │
└──────────────┴─────────────────────────────────┴───────────────┘
```

---

## 📐 详细设计

### 1. 顶部工具栏

```vue
<div class="editor-header">
  <div class="header-left">
    <el-button :icon="ArrowLeft" @click="handleBack">
      返回报告
    </el-button>
    <span class="editor-title">图表编辑器 - {{ chartTitle }}</span>
  </div>
  
  <div class="header-right">
    <el-button @click="handleReset">重置</el-button>
    <el-button @click="handleCancel">取消</el-button>
    <el-button type="primary" @click="handleSave">保存</el-button>
  </div>
</div>
```

**功能：**
- 返回按钮：返回报告页面
- 标题显示：当前编辑的图表名称
- 重置按钮：恢复到初始状态
- 取消按钮：放弃修改并返回
- 保存按钮：保存修改并返回

---

### 2. 左侧工具栏（分组折叠）

```vue
<div class="editor-sidebar-left">
  <!-- 图表类型 -->
  <el-collapse v-model="activeGroups">
    <el-collapse-item name="chartType" title="📊 图表类型">
      <el-radio-group v-model="chartType" @change="handleTypeChange">
        <el-radio label="bar">
          <el-icon><Histogram /></el-icon>
          柱状图
        </el-radio>
        <el-radio label="line">
          <el-icon><TrendCharts /></el-icon>
          折线图
        </el-radio>
        <el-radio label="pie">
          <el-icon><PieChart /></el-icon>
          饼图
        </el-radio>
        <el-radio label="scatter">
          <el-icon><ScatterChart /></el-icon>
          散点图
        </el-radio>
      </el-radio-group>
    </el-collapse-item>
    
    <!-- 数据设置 -->
    <el-collapse-item name="data" title="📐 数据设置">
      <div class="data-options">
        <el-button text @click="openDataSource">
          <el-icon><Database /></el-icon>
          数据源
        </el-button>
        <el-button text @click="openDataFilter">
          <el-icon><Filter /></el-icon>
          数据筛选
        </el-button>
        <el-button text @click="openDataSort">
          <el-icon><Sort /></el-icon>
          数据排序
        </el-button>
      </div>
    </el-collapse-item>
    
    <!-- 样式设置 -->
    <el-collapse-item name="style" title="🎨 样式设置">
      <div class="style-options">
        <el-button text @click="openColorTheme">
          <el-icon><Brush /></el-icon>
          颜色主题
        </el-button>
        <el-button text @click="openFontSettings">
          <el-icon><EditPen /></el-icon>
          字体设置
        </el-button>
        <el-button text @click="openAnimation">
          <el-icon><VideoPlay /></el-icon>
          动画效果
        </el-button>
      </div>
    </el-collapse-item>
    
    <!-- AI助手 -->
    <el-collapse-item name="ai" title="🤖 AI助手">
      <div class="ai-helper">
        <p class="helper-tip">需要复杂的修改？让AI帮你！</p>
        <el-button type="primary" @click="openAIDialog">
          <el-icon><ChatDotRound /></el-icon>
          打开AI对话
        </el-button>
      </div>
    </el-collapse-item>
  </el-collapse>
</div>
```

**功能分组：**
1. **图表类型** - 快速切换图表类型
2. **数据设置** - 数据源、筛选、排序
3. **样式设置** - 颜色、字体、动画
4. **AI助手** - 复杂修改入口

---

### 3. 中间预览区

```vue
<div class="editor-preview">
  <!-- 工具栏 -->
  <div class="preview-toolbar">
    <el-button-group>
      <el-button :icon="ZoomIn" @click="handleZoomIn">放大</el-button>
      <el-button :icon="ZoomOut" @click="handleZoomOut">缩小</el-button>
      <el-button :icon="RefreshRight" @click="handleResetZoom">重置</el-button>
    </el-button-group>
    
    <el-tag type="info">缩放: {{ zoomLevel }}%</el-tag>
  </div>
  
  <!-- 图表预览 -->
  <div class="preview-container" :style="{ transform: `scale(${zoomLevel / 100})` }">
    <div class="chart-wrapper">
      <iframe
        ref="chartPreview"
        :srcdoc="currentChartHtml"
        frameborder="0"
        sandbox="allow-scripts allow-same-origin"
      ></iframe>
    </div>
  </div>
  
  <!-- 快速操作按钮 -->
  <div class="preview-actions">
    <el-button type="primary" size="large" @click="handleApplyLocal">
      <el-icon><Check /></el-icon>
      应用修改（即时生效 ⚡）
    </el-button>
  </div>
</div>
```

**功能：**
- 实时预览修改效果
- 支持缩放查看细节
- 快速应用按钮（本地处理）

---

### 4. 右侧属性面板

```vue
<div class="editor-sidebar-right">
  <!-- 颜色主题 -->
  <div class="property-section">
    <h4>🎨 颜色主题</h4>
    <div class="color-presets">
      <div
        v-for="color in colorPresets"
        :key="color.value"
        class="color-item"
        :class="{ active: selectedColor === color.value }"
        :style="{ background: color.value }"
        @click="handleColorChange(color.value)"
      ></div>
    </div>
    <el-input
      v-model="customColor"
      placeholder="自定义颜色 #409eff"
      @change="handleColorChange(customColor)"
    >
      <template #prepend>自定义</template>
    </el-input>
  </div>
  
  <!-- 显示选项 -->
  <div class="property-section">
    <h4>👁️ 显示选项</h4>
    <el-checkbox v-model="showDataLabel" @change="handleOptionChange">
      数据标签
    </el-checkbox>
    <el-checkbox v-model="showLegend" @change="handleOptionChange">
      图例
    </el-checkbox>
    <el-checkbox v-model="showGrid" @change="handleOptionChange">
      网格线
    </el-checkbox>
    <el-checkbox v-model="showTooltip" @change="handleOptionChange">
      提示框
    </el-checkbox>
  </div>
  
  <!-- 尺寸调整 -->
  <div class="property-section">
    <h4>📏 尺寸调整</h4>
    <el-form label-width="60px" size="small">
      <el-form-item label="宽度">
        <el-input-number
          v-model="chartWidth"
          :min="400"
          :max="2000"
          @change="handleSizeChange"
        />
        <span class="unit">px</span>
      </el-form-item>
      <el-form-item label="高度">
        <el-input-number
          v-model="chartHeight"
          :min="300"
          :max="1200"
          @change="handleSizeChange"
        />
        <span class="unit">px</span>
      </el-form-item>
    </el-form>
  </div>
  
  <!-- 标题设置 -->
  <div class="property-section">
    <h4>📝 标题设置</h4>
    <el-input
      v-model="chartTitle"
      placeholder="图表标题"
      @change="handleTitleChange"
    />
    <el-input
      v-model="chartSubtitle"
      placeholder="副标题（可选）"
      @change="handleTitleChange"
    />
  </div>
  
  <!-- AI助手快捷入口 -->
  <div class="property-section ai-section">
    <h4>🤖 AI助手</h4>
    <p class="ai-tip">需要更复杂的修改？</p>
    <el-button type="primary" block @click="openAIDialog">
      打开AI对话
    </el-button>
  </div>
</div>
```

**功能：**
- 颜色主题选择
- 显示选项开关
- 尺寸精确调整
- 标题文字编辑
- AI助手快捷入口

---

## 🔧 技术实现

### 1. 组件结构

```
ChartEditorModal.vue          # 全屏编辑器主组件
├── EditorHeader.vue          # 顶部工具栏
├── EditorSidebarLeft.vue     # 左侧工具栏
├── EditorPreview.vue         # 中间预览区
├── EditorSidebarRight.vue    # 右侧属性面板
└── AIDialogPanel.vue         # AI对话面板（可选）
```

### 2. 核心功能

```typescript
// frontend/src/components/ChartEditorModal.vue

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { ChartEditor } from '@/utils/chartEditor'

const props = defineProps<{
  modelValue: boolean
  chartHtml: string
  chartTitle: string
}>()

const emit = defineEmits<{
  'update:modelValue': [value: boolean]
  'save': [html: string]
  'cancel': []
}>()

// 编辑器实例
const editor = new ChartEditor()

// 当前图表HTML
const currentChartHtml = ref(props.chartHtml)

// 图表配置
const chartType = ref('bar')
const selectedColor = ref('#409eff')
const showDataLabel = ref(true)
const showLegend = ref(true)
const showGrid = ref(true)
const chartWidth = ref(800)
const chartHeight = ref(600)

// 本地即时修改
const handleColorChange = (color: string) => {
  selectedColor.value = color
  // 立即应用（< 100ms）
  currentChartHtml.value = editor.changeColor(currentChartHtml.value, color)
}

const handleTypeChange = (type: string) => {
  chartType.value = type
  // 立即应用（< 100ms）
  currentChartHtml.value = editor.changeType(currentChartHtml.value, type)
}

const handleOptionChange = () => {
  // 立即应用显示选项
  currentChartHtml.value = editor.changeOptions(currentChartHtml.value, {
    showDataLabel: showDataLabel.value,
    showLegend: showLegend.value,
    showGrid: showGrid.value
  })
}

// 保存修改
const handleSave = () => {
  emit('save', currentChartHtml.value)
  emit('update:modelValue', false)
}

// 取消编辑
const handleCancel = () => {
  if (hasUnsavedChanges.value) {
    ElMessageBox.confirm(
      '你有未保存的修改，确定要放弃吗？',
      '确认',
      {
        confirmButtonText: '放弃',
        cancelButtonText: '继续编辑',
        type: 'warning'
      }
    ).then(() => {
      emit('cancel')
      emit('update:modelValue', false)
    })
  } else {
    emit('cancel')
    emit('update:modelValue', false)
  }
}
</script>
```

---

## 🎬 动画效果

### 进入动画
```scss
.chart-editor-modal {
  &.enter-active {
    animation: modalZoomIn 0.3s ease-out;
  }
}

@keyframes modalZoomIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
```

### 退出动画
```scss
.chart-editor-modal {
  &.leave-active {
    animation: modalZoomOut 0.3s ease-in;
  }
}

@keyframes modalZoomOut {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.9);
  }
}
```

---

## 📱 响应式设计

### 大屏（> 1440px）
- 左侧栏：240px
- 右侧栏：320px
- 中间区域：自适应

### 中屏（1024px - 1440px）
- 左侧栏：200px
- 右侧栏：280px
- 中间区域：自适应

### 小屏（< 1024px）
- 左侧栏：可折叠
- 右侧栏：可折叠
- 中间区域：全屏

---

## 🎯 用户体验优化

### 1. 即时反馈
- 所有本地修改 < 100ms
- 显示处理状态
- 成功/失败提示

### 2. 防误操作
- 未保存提示
- 重要操作二次确认
- 支持撤销/重做

### 3. 引导提示
- 首次使用引导
- 功能说明tooltip
- 快捷键提示

### 4. 性能优化
- 防抖处理
- 虚拟滚动
- 懒加载

---

## 📋 实施计划

### 第一阶段：基础框架（2小时）
- [ ] 创建ChartEditorModal组件
- [ ] 实现三栏布局
- [ ] 实现进入/退出动画
- [ ] 实现确认对话框

### 第二阶段：本地编辑器（3小时）
- [ ] 创建ChartEditor工具类
- [ ] 实现颜色修改
- [ ] 实现类型切换
- [ ] 实现显示选项
- [ ] 实现尺寸调整

### 第三阶段：UI完善（2小时）
- [ ] 完善左侧工具栏
- [ ] 完善右侧属性面板
- [ ] 实现预览缩放
- [ ] 添加快捷键

### 第四阶段：AI集成（1小时）
- [ ] 集成AI对话面板
- [ ] 实现智能路由
- [ ] 优化AI Prompt

### 第五阶段：测试优化（1小时）
- [ ] 功能测试
- [ ] 性能优化
- [ ] Bug修复

**总计：** 约9小时

---

## 🎉 预期效果

用户体验：
- ✅ 专业的全屏编辑界面
- ✅ 即时反馈（< 100ms）
- ✅ 清晰的功能分组
- ✅ 简单操作本地处理
- ✅ 复杂操作AI辅助

---

**文档版本：** 1.0  
**创建时间：** 2025-12-24  
**设计参考：** 用户提供的截图
