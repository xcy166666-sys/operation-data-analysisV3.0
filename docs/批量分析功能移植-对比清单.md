# 批量分析功能移植 - 对比清单

## 📋 功能对比总结

### 单文件数据分析 (DataAnalysis.vue) 的核心功能

#### ✅ 已有功能
1. **历史会话管理** - HistorySidebar
   - 会话列表
   - 新建会话
   - 会话搜索
   - 版本历史查看

2. **AI对话功能** - DialogPanel
   - 实时对话
   - 文本选择修改
   - 对话历史
   - 思考过程显示

3. **图表功能**
   - ChartDrawer（图表抽屉）- 带悬浮式编辑按钮
   - ChartEditorModal（图表编辑器）
   - 图表下载
   - 图表全屏

4. **版本管理**
   - 版本历史查看
   - 版本切换
   - 版本提示条

5. **报告操作**
   - 查看图表详情
   - 下载图表
   - 下载报告PDF
   - Markdown渲染

---

### 批量数据分析 (BatchAnalysis.vue) 缺少的功能

#### ❌ 缺少的核心功能

1. **AI对话功能**
   - ❌ 没有DialogPanel组件
   - ❌ 没有AI对话按钮
   - ❌ 没有文本选择修改功能
   - ❌ 没有对话历史

2. **图表编辑功能**
   - ❌ 没有ChartEditorModal组件
   - ❌ ChartDrawer没有悬浮式编辑按钮
   - ❌ 无法编辑图表

3. **版本管理功能**
   - ❌ 没有版本历史查看
   - ❌ 没有版本切换
   - ❌ 没有版本提示条

4. **文本选择编辑**
   - ❌ 没有文本选择监听
   - ❌ 没有TextEditToolbar

---

### 定制化批量分析 (CustomBatchAnalysis.vue) 缺少的功能

#### ❌ 缺少的核心功能（与BatchAnalysis.vue相同）

1. **AI对话功能** - 完全缺失
2. **图表编辑功能** - 完全缺失
3. **版本管理功能** - 完全缺失
4. **文本选择编辑** - 完全缺失

---

## 🎯 需要移植的功能清单

### 1. AI对话功能

#### 组件
- ✅ DialogPanel.vue（已存在）
- ✅ 对话API（已存在）

#### 需要添加
- [ ] 在BatchAnalysis.vue中添加AI对话按钮
- [ ] 在CustomBatchAnalysis.vue中添加AI对话按钮
- [ ] 添加DialogPanel组件引用
- [ ] 添加对话面板状态管理
- [ ] 添加对话面板宽度调整功能
- [ ] 添加AI对话模式布局（左右分栏）

---

### 2. 图表编辑功能

#### 组件
- ✅ ChartEditorModal.vue（已存在）
- ✅ ChartDrawer.vue（已存在，但需要添加编辑按钮）

#### 需要添加
- [ ] 在ReportDisplay.vue中添加ChartDrawer的edit-chart事件监听
- [ ] 在BatchAnalysis.vue中添加ChartEditorModal组件
- [ ] 在CustomBatchAnalysis.vue中添加ChartEditorModal组件
- [ ] 添加图表编辑器状态管理
- [ ] 添加handleEditChartFromDrawer函数
- [ ] 添加handleChartEditorSave函数

---

### 3. 版本管理功能

#### 需要添加
- [ ] 在BatchHistorySidebar中添加版本历史功能
- [ ] 在CustomBatchHistorySidebar中添加版本历史功能
- [ ] 添加版本提示条
- [ ] 添加版本切换功能
- [ ] 添加返回当前版本按钮

---

### 4. 文本选择编辑功能

#### 需要添加
- [ ] 添加文本选择监听
- [ ] 添加TextEditToolbar组件（如果需要）
- [ ] 添加选中文字传递给DialogPanel

---

## 📝 实施步骤

### 步骤1：修改ReportDisplay.vue
1. 添加ChartDrawer的edit-chart事件
2. 添加emit('edit-chart')

### 步骤2：修改BatchAnalysis.vue
1. 导入DialogPanel和ChartEditorModal
2. 添加AI对话按钮
3. 添加对话面板状态管理
4. 添加图表编辑器状态管理
5. 添加AI对话模式布局
6. 添加ChartDrawer的edit-chart监听
7. 添加handleEditChartFromDrawer函数
8. 添加handleChartEditorSave函数

### 步骤3：修改CustomBatchAnalysis.vue
1. 与步骤2相同的修改

### 步骤4：测试
1. 测试AI对话功能
2. 测试图表编辑功能
3. 测试图表抽屉的悬浮式编辑按钮

---

## ⚠️ 注意事项

1. **不修改单文件分析功能** - 只移植，不改动DataAnalysis.vue
2. **保持批量分析的特性** - 多Sheet标签页切换
3. **状态管理** - 使用operationStore的批量分析状态
4. **API调用** - 使用批量分析的API（getSheetReport等）
5. **组件复用** - 复用DialogPanel、ChartEditorModal、ChartDrawer

---

## 📊 功能对比表

| 功能 | DataAnalysis.vue | BatchAnalysis.vue | CustomBatchAnalysis.vue | 需要移植 |
|------|------------------|-------------------|-------------------------|----------|
| AI对话 | ✅ | ❌ | ❌ | ✅ |
| 图表编辑 | ✅ | ❌ | ❌ | ✅ |
| 图表抽屉 | ✅ | ✅ | ✅ | ⚠️ 需要添加编辑按钮 |
| 版本历史 | ✅ | ❌ | ❌ | ⚠️ 可选 |
| 文本选择编辑 | ✅ | ❌ | ❌ | ⚠️ 可选 |
| 历史会话 | ✅ | ✅ | ✅ | ✅ |
| 报告下载 | ✅ | ✅ | ✅ | ✅ |
| 图表下载 | ✅ | ✅ | ✅ | ✅ |

---

**创建时间：** 2025-12-25  
**创建人：** Kiro AI Assistant
