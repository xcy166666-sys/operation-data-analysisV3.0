# 版本历史二级菜单 - 实现说明

## 📋 功能概述

实现了类似您提供截图的二级下拉菜单效果：
- 点击会话项右侧的向下箭头，在会话项下方展开版本列表
- 版本列表作为二级菜单显示，带有缩进效果
- 平滑的展开/折叠动画
- 清晰的视觉层次

---

## 🎨 界面效果

### 折叠状态
```
┌─────────────────────────────────────┐
│ 📄 LTV - 副本 (2)                    │
│    今天          进行中    [↓] [×]  │  ← 点击向下箭头展开
└─────────────────────────────────────┘
```

### 展开状态
```
┌─────────────────────────────────────┐
│ 📄 LTV - 副本 (2)                    │
│    今天          进行中    [↑] [×]  │  ← 点击向上箭头收起
├─────────────────────────────────────┤
│    📄 V2                    [当前]  │  ← 版本2（二级菜单）
│       2分钟前 - 添加了新的分析章节   │
├─────────────────────────────────────┤
│    📄 V1                            │  ← 版本1（二级菜单）
│       10分钟前 - 初始版本            │
└─────────────────────────────────────┘
```

---

## 🔧 实现细节

### 1. 结构调整

#### 会话项结构
```vue
<div class="session-item">
  <!-- 会话主体（可点击选择会话） -->
  <div class="session-main" @click="handleLoadSession">
    <div class="session-icon">📄</div>
    <div class="session-info">
      <div class="session-title">会话标题</div>
      <div class="session-meta">时间 + 状态</div>
    </div>
    <div class="session-actions">
      <button @click="toggleVersions">↓/↑</button>
      <button @click="deleteSession">×</button>
    </div>
  </div>
  
  <!-- 版本二级菜单（可展开/折叠） -->
  <transition name="version-expand">
    <div v-if="expanded" class="version-submenu">
      <div class="version-item">版本1</div>
      <div class="version-item">版本2</div>
    </div>
  </transition>
</div>
```

### 2. 样式特点

#### 会话项样式
- **背景色**：`#363638`（深灰色）
- **边框**：`1px solid #3a3a3c`
- **圆角**：`8px`
- **悬停效果**：背景色变亮
- **激活状态**：蓝色边框 + 阴影

#### 版本二级菜单样式
- **背景色**：`#2c2c2e`（更深的灰色）
- **边框顶部**：`1px solid #3a3a3c`
- **缩进**：左侧 `40px`（通过 padding-left 实现）
- **左侧指示线**：`3px` 蓝色边框（悬停时显示）
- **当前版本**：绿色左侧边框 + 绿色背景

#### 版本项样式
```css
.version-item {
  padding: 10px 16px 10px 40px;  /* 左侧缩进40px */
  border-left: 3px solid transparent;
  transition: all 0.2s;
}

.version-item:hover {
  background: rgba(255, 255, 255, 0.05);
  border-left-color: #007aff;  /* 蓝色指示线 */
}

.version-item.current {
  background: rgba(76, 222, 128, 0.1);  /* 绿色背景 */
  border-left-color: #4ade80;  /* 绿色指示线 */
}
```

### 3. 动画效果

#### 展开/折叠动画
```css
.version-expand-enter-active,
.version-expand-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  max-height: 500px;
  overflow: hidden;
}

.version-expand-enter-from,
.version-expand-leave-to {
  max-height: 0;
  opacity: 0;
}
```

**效果**：
- 展开时：从 `max-height: 0` 到 `max-height: 500px`
- 折叠时：从 `max-height: 500px` 到 `max-height: 0`
- 同时伴随透明度变化（`opacity: 0` ↔ `opacity: 1`）
- 使用 `cubic-bezier` 缓动函数，实现平滑自然的动画

---

## 🎯 交互逻辑

### 1. 展开/折叠版本列表

**触发方式**：点击会话项右侧的向下/向上箭头按钮

**逻辑**：
```typescript
const toggleVersions = async (sessionId: number) => {
  // 如果当前会话已展开，则收起
  if (expandedSessionId.value === sessionId) {
    expandedSessionId.value = null
    return
  }
  
  // 展开当前会话，收起其他会话
  expandedSessionId.value = sessionId
  
  // 首次展开时加载版本列表
  if (!versionsMap.value[sessionId]) {
    await loadVersions(sessionId)
  }
}
```

**特点**：
- 同时只能展开一个会话的版本列表
- 首次展开时自动加载版本列表
- 已加载的版本列表会缓存，再次展开时不会重复加载

### 2. 选择会话

**触发方式**：点击会话主体区域（不包括按钮）

**逻辑**：
```typescript
const handleLoadSession = (sessionId: number) => {
  operationStore.setCurrentSession(sessionId)
  emit('session-selected', sessionId)
}
```

**特点**：
- 点击会话主体选择会话
- 不会触发版本列表的展开/折叠
- 选中的会话会有蓝色边框高亮

### 3. 查看版本

**触发方式**：点击版本项

**逻辑**：
```typescript
const handleSelectVersion = async (sessionId: number, versionId: number) => {
  const res = await getSessionVersionDetail(sessionId, versionId)
  if (res.success && res.data) {
    emit('version-selected', { sessionId, version: res.data })
    ElMessage.success(`已切换到版本 V${res.data.version_no}`)
  }
}
```

**特点**：
- 点击版本项查看该版本的报告
- 显示加载提示和成功消息
- 触发 `version-selected` 事件，通知父组件

---

## 🎨 视觉层次

### 层次1：会话列表
- **背景色**：`#363638`
- **文字颜色**：`#fff`（白色）
- **图标颜色**：`#007aff`（蓝色）

### 层次2：版本二级菜单
- **背景色**：`#2c2c2e`（比会话列表更深）
- **文字颜色**：`#fff`（白色）
- **图标颜色**：`#888`（灰色）
- **缩进**：左侧 `40px`

### 层次3：当前版本高亮
- **背景色**：`rgba(76, 222, 128, 0.1)`（绿色半透明）
- **左侧边框**：`3px solid #4ade80`（绿色）
- **图标颜色**：`#4ade80`（绿色）

---

## 📊 对比：旧版 vs 新版

### 旧版（版本面板）
```
┌─────────────────────────────────────┐
│ 📄 LTV - 副本 (2)          [📄] [×] │
│    今天          进行中             │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│ 📌 版本历史 (2个版本)               │  ← 独立的版本面板
│ V2 - 添加了新的分析章节    [当前]   │
│ V1 - 初始版本                       │
└─────────────────────────────────────┘
```

**特点**：
- 版本面板独立显示
- 占用额外空间
- 视觉上与会话项分离

### 新版（二级菜单）
```
┌─────────────────────────────────────┐
│ 📄 LTV - 副本 (2)          [↓] [×]  │
│    今天          进行中             │
├─────────────────────────────────────┤
│    📄 V2                    [当前]  │  ← 二级菜单
│       2分钟前 - 添加了新的分析章节   │
├─────────────────────────────────────┤
│    📄 V1                            │
│       10分钟前 - 初始版本            │
└─────────────────────────────────────┘
```

**特点**：
- 版本列表作为会话项的子菜单
- 节省空间
- 视觉上更加紧凑
- 层次关系更清晰

---

## ✅ 优势

### 1. 更好的空间利用
- 版本列表只在需要时展开
- 不占用额外的固定空间
- 适合显示多个会话

### 2. 更清晰的层次关系
- 会话 → 版本的层次关系一目了然
- 缩进和颜色区分清晰
- 符合用户的心智模型

### 3. 更流畅的交互
- 平滑的展开/折叠动画
- 悬停时的视觉反馈
- 清晰的状态指示

### 4. 更好的视觉设计
- 深色主题统一
- 颜色搭配协调
- 符合现代UI设计趋势

---

## 🧪 测试要点

### 1. 展开/折叠
- [ ] 点击箭头按钮，版本列表平滑展开
- [ ] 再次点击箭头按钮，版本列表平滑收起
- [ ] 展开一个会话时，其他会话的版本列表自动收起
- [ ] 箭头图标正确切换（↓ ↔ ↑）

### 2. 视觉效果
- [ ] 版本列表有明显的缩进（左侧40px）
- [ ] 悬停时显示蓝色左侧边框
- [ ] 当前版本显示绿色左侧边框和背景
- [ ] 动画流畅自然（300ms）

### 3. 交互逻辑
- [ ] 点击会话主体选择会话
- [ ] 点击版本项查看版本
- [ ] 点击箭头按钮展开/折叠版本列表
- [ ] 点击删除按钮删除会话

### 4. 加载状态
- [ ] 首次展开时显示加载动画
- [ ] 加载完成后显示版本列表
- [ ] 空状态显示友好提示

---

## 📝 使用说明

### 查看版本列表
1. 找到您想查看版本的会话
2. 点击会话项右侧的 **向下箭头** 按钮
3. 版本列表会在会话项下方展开

### 收起版本列表
1. 点击会话项右侧的 **向上箭头** 按钮
2. 版本列表会平滑收起

### 查看版本详情
1. 展开版本列表
2. 点击任意版本项
3. 右侧主内容区会显示该版本的报告

### 返回当前版本
1. 点击页面顶部版本提示条中的 **"返回当前版本"** 按钮
2. 报告内容会恢复为最新版本

---

## 🎉 总结

新的二级菜单设计：
- ✅ 更符合您的需求（类似截图的效果）
- ✅ 更好的空间利用
- ✅ 更清晰的层次关系
- ✅ 更流畅的交互体验
- ✅ 更现代的视觉设计

现在您可以访问 http://localhost:5173 查看新的效果！
