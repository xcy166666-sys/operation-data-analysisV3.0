# æŠ¥å‘Šç‰ˆæœ¬å†å²åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

---

## æ­¥éª¤1ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend bash

# è¿è¡Œè¿ç§»
alembic upgrade head

# éªŒè¯è¿ç§»æˆåŠŸï¼ˆåº”è¯¥çœ‹åˆ° add_session_versionsï¼‰
alembic current

# é€€å‡ºå®¹å™¨
exit
```

**é¢„æœŸè¾“å‡º**:
```
INFO  [alembic.runtime.migration] Running upgrade -> add_session_versions
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
```

---

## æ­¥éª¤2ï¼šé‡å¯æœåŠ¡ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# é‡å¯åç«¯
docker-compose restart backend

# ç­‰å¾…5ç§’
timeout /t 5

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
docker-compose logs --tail=20 backend
```

**é¢„æœŸè¾“å‡º**:
```
backend_1  | INFO:     Application startup complete.
```

---

## æ­¥éª¤3ï¼šåˆ·æ–°å‰ç«¯ï¼ˆ1åˆ†é’Ÿï¼‰

1. æ‰“å¼€æµè§ˆå™¨
2. æŒ‰ `Ctrl + Shift + Delete` æ¸…é™¤ç¼“å­˜
3. æŒ‰ `Ctrl + F5` ç¡¬åˆ·æ–°é¡µé¢
4. é‡æ–°ç™»å½•ç³»ç»Ÿ

---

## æ­¥éª¤4ï¼šåˆ›å»ºæµ‹è¯•æ•°æ®ï¼ˆ1åˆ†é’Ÿï¼‰

### æ–¹æ³•1ï¼šé€šè¿‡æµè§ˆå™¨æ§åˆ¶å°ï¼ˆæ¨èï¼‰

1. æ‰“å¼€æ•°æ®åˆ†æé¡µé¢
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° `Console` æ ‡ç­¾
4. å¤åˆ¶ç²˜è´´ä»¥ä¸‹ä»£ç å¹¶å›è½¦ï¼š

```javascript
// è·å–å½“å‰ä¼šè¯IDï¼ˆä»URLæˆ–é¡µé¢ä¸­è·å–ï¼‰
const sessionId = 66; // æ›¿æ¢ä¸ºä½ çš„ä¼šè¯ID

// åˆ›å»ºæµ‹è¯•ç‰ˆæœ¬
fetch(`/api/v1/operation/sessions/${sessionId}/versions`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  },
  body: JSON.stringify({
    summary: "æµ‹è¯•ç‰ˆæœ¬1",
    report_text: "è¿™æ˜¯æµ‹è¯•æŠ¥å‘Šçš„æ–‡å­—å†…å®¹",
    report_html_charts: "<div>æµ‹è¯•å›¾è¡¨</div>",
    report_charts_json: []
  })
})
.then(res => res.json())
.then(data => {
  console.log('âœ… ç‰ˆæœ¬åˆ›å»ºæˆåŠŸ:', data);
  alert('æµ‹è¯•ç‰ˆæœ¬åˆ›å»ºæˆåŠŸï¼');
})
.catch(err => {
  console.error('âŒ åˆ›å»ºå¤±è´¥:', err);
  alert('åˆ›å»ºå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°');
});
```

### æ–¹æ³•2ï¼šé€šè¿‡åç«¯Pythonï¼ˆå¤‡é€‰ï¼‰

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend bash

# è¿›å…¥Python shell
python

# æ‰§è¡Œä»¥ä¸‹ä»£ç 
from app.core.database import SessionLocal
from app.models.session_version import AnalysisSessionVersion
from datetime import datetime

db = SessionLocal()

# åˆ›å»ºæµ‹è¯•ç‰ˆæœ¬
version = AnalysisSessionVersion(
    session_id=66,  # æ›¿æ¢ä¸ºå®é™…çš„ä¼šè¯ID
    version_no=1,
    summary="æµ‹è¯•ç‰ˆæœ¬1",
    report_text="è¿™æ˜¯æµ‹è¯•æŠ¥å‘Šçš„æ–‡å­—å†…å®¹",
    report_html_charts="<div>æµ‹è¯•å›¾è¡¨</div>",
    report_charts_json=[],
    created_at=datetime.utcnow(),
    created_by=1
)

db.add(version)
db.commit()
print(f"âœ… ç‰ˆæœ¬å·²åˆ›å»º: ID={version.id}")

db.close()
exit()
```

---

## æ­¥éª¤5ï¼šæµ‹è¯•åŠŸèƒ½ï¼ˆ1åˆ†é’Ÿï¼‰

### æµ‹è¯•1ï¼šå±•å¼€ç‰ˆæœ¬åˆ—è¡¨

1. åœ¨å·¦ä¾§å†å²ä¼šè¯åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªä¼šè¯
2. ç‚¹å‡»ä¼šè¯å³ä¾§çš„ ğŸ“„ å›¾æ ‡æŒ‰é’®
3. è§‚å¯Ÿç‰ˆæœ¬åˆ—è¡¨æ˜¯å¦å±•å¼€

**é¢„æœŸç»“æœ**: âœ… ç‰ˆæœ¬åˆ—è¡¨åœ¨ä¼šè¯ä¸‹æ–¹å±•å¼€ï¼Œæ˜¾ç¤º"V1 æµ‹è¯•ç‰ˆæœ¬1"

### æµ‹è¯•2ï¼šåˆ‡æ¢ç‰ˆæœ¬

1. ç‚¹å‡»ç‰ˆæœ¬åˆ—è¡¨ä¸­çš„æŸä¸ªç‰ˆæœ¬
2. è§‚å¯Ÿå³ä¾§æŠ¥å‘ŠåŒºåŸŸ

**é¢„æœŸç»“æœ**: âœ… æ˜¾ç¤ºæç¤º"å·²åˆ‡æ¢åˆ°ç‰ˆæœ¬ V1"ï¼ŒæŠ¥å‘Šå†…å®¹æ›´æ–°

### æµ‹è¯•3ï¼šæŠ˜å ç‰ˆæœ¬åˆ—è¡¨

1. å†æ¬¡ç‚¹å‡» ğŸ“„ å›¾æ ‡æŒ‰é’®
2. è§‚å¯Ÿç‰ˆæœ¬åˆ—è¡¨æ˜¯å¦æŠ˜å 

**é¢„æœŸç»“æœ**: âœ… ç‰ˆæœ¬åˆ—è¡¨å¹³æ»‘æŠ˜å 

---

## ğŸ‰ å®Œæˆï¼

å¦‚æœä»¥ä¸Šæµ‹è¯•éƒ½é€šè¿‡ï¼Œè¯´æ˜ç‰ˆæœ¬å†å²åŠŸèƒ½å·²ç»æˆåŠŸéƒ¨ç½²ï¼

---

## å¸¸è§é—®é¢˜

### Q1: ç‚¹å‡»å±•å¼€æŒ‰é’®æ²¡æœ‰ååº”ï¼Ÿ

**è§£å†³æ–¹æ³•**:
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
2. æŸ¥çœ‹æ˜¯å¦æœ‰JavaScripté”™è¯¯
3. æ£€æŸ¥Networkæ ‡ç­¾ï¼Œçœ‹APIè¯·æ±‚æ˜¯å¦æˆåŠŸ
4. ç¡®è®¤å·²ç»æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### Q2: ç‰ˆæœ¬åˆ—è¡¨æ˜¾ç¤º"æš‚æ— ç‰ˆæœ¬"ï¼Ÿ

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤å·²ç»åˆ›å»ºäº†æµ‹è¯•æ•°æ®
2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼š
```bash
docker-compose exec postgres psql -U postgres -d operation_analysis
SELECT * FROM analysis_session_versions;
\q
```

### Q3: åˆ‡æ¢ç‰ˆæœ¬åæŠ¥å‘Šæ²¡æœ‰æ›´æ–°ï¼Ÿ

**è§£å†³æ–¹æ³•**:
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥ç‰ˆæœ¬æ•°æ®ä¸­æ˜¯å¦æœ‰ `report_text` å­—æ®µ
4. åˆ·æ–°é¡µé¢é‡è¯•

### Q4: æ•°æ®åº“è¿ç§»å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥è¿ç§»æ–‡ä»¶çš„ `down_revision` æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹æ•°æ®åº“ä¸­çš„ `alembic_version` è¡¨
3. å¦‚æœéœ€è¦ï¼Œæ‰‹åŠ¨åˆ›å»ºè¡¨ï¼š
```sql
-- è¿›å…¥æ•°æ®åº“
docker-compose exec postgres psql -U postgres -d operation_analysis

-- æ‰‹åŠ¨åˆ›å»ºè¡¨
CREATE TABLE analysis_session_versions (
    id SERIAL PRIMARY KEY,
    session_id INTEGER NOT NULL REFERENCES analysis_sessions(id) ON DELETE CASCADE,
    version_no INTEGER NOT NULL,
    summary VARCHAR(255),
    report_text TEXT,
    report_html_charts TEXT,
    report_charts_json JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    created_by INTEGER REFERENCES users(id) ON DELETE SET NULL
);

CREATE INDEX idx_session_versions_session_id_version_no 
ON analysis_session_versions(session_id, version_no);
```

---

## ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš

1. âœ… åˆ›å»ºæ›´å¤šæµ‹è¯•ç‰ˆæœ¬
2. âœ… æµ‹è¯•å¤šä¸ªä¼šè¯çš„ç‰ˆæœ¬ç®¡ç†
3. âœ… æµ‹è¯•ç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½

### æœ¬å‘¨å®Œæˆ

1. ğŸ“… å®ç°è‡ªåŠ¨ä¿å­˜ç‰ˆæœ¬åŠŸèƒ½
2. ğŸ“… æ·»åŠ "ä¿å­˜ç‰ˆæœ¬"æŒ‰é’®
3. ğŸ“… å®ç°ç‰ˆæœ¬å›æ»šåŠŸèƒ½

### ä¸‹å‘¨å®Œæˆ

1. ğŸ“… å®ç°ç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½
2. ğŸ“… å®ç°ç‰ˆæœ¬åˆ é™¤åŠŸèƒ½
3. ğŸ“… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

## å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æ•°æ®åº“æ“ä½œ

```bash
# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
docker-compose exec postgres psql -U postgres -d operation_analysis -c "SELECT * FROM analysis_session_versions;"

# æŸ¥çœ‹æŸä¸ªä¼šè¯çš„ç‰ˆæœ¬
docker-compose exec postgres psql -U postgres -d operation_analysis -c "SELECT * FROM analysis_session_versions WHERE session_id = 66;"

# åˆ é™¤æ‰€æœ‰æµ‹è¯•ç‰ˆæœ¬
docker-compose exec postgres psql -U postgres -d operation_analysis -c "DELETE FROM analysis_session_versions WHERE summary LIKE 'æµ‹è¯•%';"
```

### æœåŠ¡æ“ä½œ

```bash
# é‡å¯åç«¯
docker-compose restart backend

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs -f backend

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
docker-compose logs --tail=50 backend
```

### å‰ç«¯æ“ä½œ

```bash
# å¼€å‘æ¨¡å¼
cd frontend && npm run dev

# ç”Ÿäº§æ„å»º
cd frontend && npm run build

# ç±»å‹æ£€æŸ¥
cd frontend && npm run type-check
```

---

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. ğŸ“– [å®Œæ•´å®æ–½æ€»ç»“](./æŠ¥å‘Šç‰ˆæœ¬å†å²åŠŸèƒ½-å®Œæ•´å®æ–½æ€»ç»“.md)
2. ğŸ“– [éƒ¨ç½²ä¸æµ‹è¯•æŒ‡å—](./æŠ¥å‘Šç‰ˆæœ¬å†å²åŠŸèƒ½-éƒ¨ç½²ä¸æµ‹è¯•æŒ‡å—.md)
3. ğŸ“– [é—®é¢˜è¯Šæ–­ä¸ä¿®å¤](./æŠ¥å‘Šç‰ˆæœ¬å†å²åŠŸèƒ½-é—®é¢˜è¯Šæ–­ä¸ä¿®å¤.md)

æˆ–è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒã€‚

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
