#!/usr/bin/env python3
"""彻底修复 Vue 文件的编码问题"""
import re
import sys

file_path = 'frontend/src/views/Operation/DataAnalysis.vue'

try:
    # 读取文件，使用 replace 错误处理
    with open(file_path, 'r', encoding='utf-8', errors='replace') as f:
        content = f.read()
    
    print(f"原始文件大小: {len(content)} 字符")
    
    # 统计乱码字符
    bad_chars = content.count('�')
    print(f"发现 {bad_chars} 个乱码字符")
    
    # 使用正则表达式修复所有常见的乱码模式
    # 模式：中文词 + � + 可选的其他字符 + )
    patterns = [
        (r'显示�\)', '显示）'),
        (r'分析�\)', '分析）'),
        (r'提示�\)', '提示）'),
        (r'管理员�\)', '管理员）'),
        (r'工作流�\)', '工作流）'),
        (r'隐藏�\)', '隐藏）'),
        (r'面板�\)', '面板）'),
        (r'分隔线�\)', '分隔线）'),
        (r'展示�\)', '展示）'),
        (r'文本�\)', '文本）'),
        (r'上传�\)', '上传）'),
        (r'需求�\)', '需求）'),
        (r'标签�\)', '标签）'),
        (r'生成中�\)', '生成中）'),
        (r'弹窗�\)', '弹窗）'),
        (r'配置�\)', '配置）'),
        (r'开发中�\)', '开发中）'),
        (r'参数名�\)', '参数名）'),
        (r'名称�\)', '名称）'),
        (r'模板�\)', '模板）'),
        (r'占位符�\)', '占位符）'),
        (r'描述�\)', '描述）'),
        (r'绑定�\)', '绑定）'),
        (r'模式�\)', '模式）'),
        (r'状态�\)', '状态）'),
        (r'调整�\)', '调整）'),
        (r'避免�\)', '避免）'),
        (r'问题�\)', '问题）'),
        (r'必须�\)', '必须）'),
        (r'趋势�,', '趋势',),
        (r'表现�,', '表现',),
        (r'分析�,', '分析',),
        (r'切换�\)', '切换）'),
        (r'嵌入�\)', '嵌入）'),
        (r'条件�\)', '条件）'),
        (r'表单�\)', '表单）'),
        (r'页面�\)', '页面）'),
        (r'保存�,', '保存',),
        (r'版本�\)', '版本）'),
        (r'数据�\)', '数据）'),
        (r'修改�\)', '修改）'),
        (r'长度�\)', '长度）'),
        (r'内容�\)', '内容）'),
        (r'更新�\)', '更新）'),
        (r'清空�\)', '清空）'),
        (r'宽度�\)', '宽度）'),
        (r'会话�\)', '会话）'),
        (r'配置�\)', '配置）'),
        (r'文件�\)', '文件）'),
        (r'大小�\)', '大小）'),
        (r'记录中�\)', '记录中）'),
        (r'需求�\)', '需求）'),
        (r'对话框�\)', '对话框）'),
        (r'数据�\)', '数据）'),
        (r'存在�\)', '存在）'),
        (r'禁用�\)', '禁用）'),
        (r'尺寸�\)', '尺寸）'),
        (r'高度�\)', '高度）'),
        (r'限制�\)', '限制）'),
        (r'调整�\)', '调整）'),
        (r'清理�\)', '清理）'),
        (r'销毁�\)', '销毁）'),
        (r'实例�\)', '实例）'),
        (r'再试�\)', '再试）'),
        (r'报告�\)', '报告）'),
        (r'稍候�\)', '稍候）'),
        (r'图片�\)', '图片）'),
        (r'等待�\)', '等待）'),
        (r'绘制�\)', '绘制）'),
        (r'完成�\)', '完成）'),
        (r'继续�\)', '继续）'),
        (r'方法�\)', '方法）'),
        (r'参数�\)', '参数）'),
        (r'链接�\)', '链接）'),
        (r'详情�\)', '详情）'),
        (r'长度�\)', '长度）'),
        (r'后端�\)', '后端）'),
        (r'加载�\)', '加载）'),
        (r'处理了�\)', '处理了）'),
        (r'时间�\)', '时间）'),
        (r'样式�\)', '样式）'),
        (r'容器�\)', '容器）'),
        (r'偏移�\)', '偏移）'),
        (r'线�\)', '线）'),
        (r'溢出�\)', '溢出）'),
        (r'窗口�\)', '窗口）'),
        # 处理不带括号的情况
        (r'不保�', '不保存'),
        (r'失败�', '失败'),
        (r'成功�', '成功'),
        (r'完成�', '完成'),
        (r'修改�', '修改'),
        (r'更新�', '更新'),
        (r'删除�', '删除'),
        (r'添加�', '添加'),
        (r'保存�', '保存'),
        (r'加载�', '加载'),
        (r'生成�', '生成'),
        (r'创建�', '创建'),
        (r'配置�', '配置'),
        (r'工作流�', '工作流'),
        (r'文本�', '文本'),
        (r'图表�', '图表'),
        (r'报告�', '报告'),
        (r'会话�', '会话'),
        (r'版本�', '版本'),
        (r'数据�', '数据'),
        (r'文件�', '文件'),
        (r'内容�', '内容'),
        (r'模式�', '模式'),
        (r'状态�', '状态'),
        (r'列表�', '列表'),
        (r'详情�', '详情'),
        (r'历史�', '历史'),
        (r'当前�', '当前'),
        (r'新建�', '新建'),
        (r'编辑�', '编辑'),
        (r'查看�', '查看'),
        (r'下载�', '下载'),
        (r'上传�', '上传'),
        (r'分析�', '分析'),
        (r'批量�', '批量'),
        (r'单个�', '单个'),
        (r'全部�', '全部'),
        (r'部分�', '部分'),
        (r'选中�', '选中'),
        (r'取消�', '取消'),
        (r'确认�', '确认'),
        (r'提交�', '提交'),
        (r'返回�', '返回'),
        (r'关闭�', '关闭'),
        (r'打开�', '打开'),
        (r'展开�', '展开'),
        (r'收起�', '收起'),
        (r'显示�', '显示'),
        (r'隐藏�', '隐藏'),
        (r'启用�', '启用'),
        (r'禁用�', '禁用'),
        (r'正常�', '正常'),
        (r'异常�', '异常'),
        (r'错误�', '错误'),
        (r'警告�', '警告'),
        (r'提示�', '提示'),
        (r'信息�', '信息'),
        (r'成功�', '成功'),
        (r'失败�', '失败'),
        (r'等待�', '等待'),
        (r'处理�', '处理'),
        (r'完成�', '完成'),
        (r'进行中�', '进行中'),
        (r'已完成�', '已完成'),
        (r'未完成�', '未完成'),
        (r'已取消�', '已取消'),
        (r'已删除�', '已删除'),
        (r'已保存�', '已保存'),
        (r'未保存�', '未保存'),
    ]
    
    for pattern, replacement in patterns:
        content = re.sub(pattern, replacement, content)
    
    # 移除所有剩余的 � 字符
    content = content.replace('�', '')
    
    # 保存文件
    with open(file_path, 'w', encoding='utf-8', newline='\n') as f:
        f.write(content)
    
    print(f"✓ 文件已修复并保存")
    print(f"  应用了 {len(patterns)} 个修复模式")
    print(f"  最终文件大小: {len(content)} 字符")
    
except Exception as e:
    print(f"✗ 修复失败: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)
