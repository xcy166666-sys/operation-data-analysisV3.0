#!/usr/bin/env python3
"""修复 DataAnalysis.vue 文件的编码问题"""
import re

# 读取文件
file_path = 'frontend/src/views/Operation/DataAnalysis.vue'

try:
    # 尝试用不同编码读取
    with open(file_path, 'r', encoding='utf-8', errors='replace') as f:
        content = f.read()
    
    # 替换所有乱码字符
    replacements = {
        '�?': '）',
        '�': '',
        '显�': '显示',
        '分�': '分析',
        '提�': '提示',
        '管理�': '管理员',
        '工作�': '工作流',
        '隐�': '隐藏',
        '面�': '面板',
        '分隔�': '分隔线',
        '展�': '展示',
        '文�': '文本',
        '上�': '上传',
        '需�': '需求',
        '标�': '标签',
        '生成�': '生成中',
        '弹�': '弹窗',
        '配�': '配置',
        '开发中�': '开发中）',
        '参数�': '参数名',
        '名�': '名称',
        '模�': '模板',
        '占位�': '占位符',
        '描�': '描述',
        '绑�': '绑定',
        '模式�': '模式）',
        '状�': '状态',
        '调�': '调整',
        '避�': '避免',
        '问题�': '问题）',
        '必�': '必须',
        '趋�': '趋势',
        '表�': '表现',
        '分�': '分析',
        '切�': '切换',
        '相关状�': '相关状态',
        '嵌入�': '嵌入）',
        '条�': '条件',
        '处理，不显示错误）（简化版，移除project_id参数�': '处理，不显示错误）（简化版，移除project_id参数）',
        '表�': '表单',
        '页�': '页面',
        '保�': '保存',
        '版�': '版本',
        '模�': '模式',
        '数�': '数据',
        '配�': '配置',
        '修改�': '修改）',
        '修�': '修改',
        '长�': '长度',
        '内�': '内容',
        '更�': '更新',
        '清�': '清空',
        '模式�': '模式）',
        '宽�': '宽度',
        '会�': '会话',
        '分�': '分析',
        '配�': '配置',
        '列表（但不自动选择�': '列表（但不自动选择）',
        '情况�': '情况）',
        '包括html_charts�': '包括html_charts）',
        '器�': '器）',
        '格�': '格式',
        '固定�': '固定值',
        '工作�': '工作流',
        '成�': '成功',
        '文�': '文件',
        '大�': '大小',
        '会�': '会话',
        '记录�': '记录中',
        '文�': '文件',
        '需�': '需求',
        '分�': '分析',
        '文�': '文件',
        '对话�': '对话框',
        '数�': '数据',
        '�': '无',
        '存�': '存在',
        '禁�': '禁用',
        '对话�': '对话框',
        '�': '到',
        '配�': '配置',
        '尺�': '尺寸',
        '高�': '高度',
        '限�': '限制',
        '调�': '调整',
        '调整�': '调整）',
        '清�': '清理',
        '降级方案：如果没有html_charts，使用ECharts�': '降级方案：如果没有html_charts，使用ECharts）',
        '销�': '销毁',
        '调�': '调整',
        '实�': '实例',
        '再�': '再试',
        '报�': '报告',
        '模�': '模式',
        '候再�': '候再试',
        '稍�': '稍候',
        '图�': '图片',
        '图表，使�': '图表，使用',
        '稍�': '稍候',
        '等�': '等待',
        '绘�': '绘制',
        '完�': '完成',
        '继�': '继续',
        '转换�': '转换为',
        '为�': '为空',
        '方�': '方法',
        '参数�': '参数）',
        '�': '为',
        '链�': '链接',
        '详�': '详情',
        '模�': '模式',
        '长�': '长度',
        '恢复（更可靠�': '恢复（更可靠）',
        '长�': '长度',
        '后端�': '后端）',
        '中的�': '中的值',
        '后�': '后端',
        '模�': '模式',
        '加�': '加载',
        '有�': '有）',
        '处理�': '处理了',
        '时�': '时间',
        '模�': '模式',
        '版�': '版本',
        '样�': '样式',
        '容�': '容器',
        '偏�': '偏移',
        '线�': '线）',
        '溢�': '溢出',
        '高�': '高度',
        '窗�': '窗口',
    }
    
    for old, new in replacements.items():
        content = content.replace(old, new)
    
    # 保存文件
    with open(file_path, 'w', encoding='utf-8', newline='\n') as f:
        f.write(content)
    
    print(f"✓ 文件编码已修复: {file_path}")
    print(f"  替换了 {len(replacements)} 个乱码模式")
    
except Exception as e:
    print(f"✗ 修复失败: {e}")
    import traceback
    traceback.print_exc()
